% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/eval_module.R
\name{eval_module}
\alias{eval_module}
\title{Evaluate a Monte Carlo Model Expression and create an mcmodule}
\usage{
eval_module(
  exp,
  data,
  param_names = NULL,
  prev_mcmodule = NULL,
  summary = FALSE,
  mctable = set_mctable(),
  data_keys = set_data_keys(),
  match_keys = NULL,
  keys = NULL,
  overwrite_keys = NULL
)
}
\arguments{
\item{exp}{Model expression or list of expressions to evaluate}

\item{data}{Input data frame containing model parameters. The number of
rows of \code{data} determines nvariates for mcstoc()/mcdata() used in expressions.}

\item{param_names}{Named vector for parameter renaming (optional)}

\item{prev_mcmodule}{Previous module(s) for dependent calculations}

\item{summary}{Logical; whether to calculate summary statistics}

\item{mctable}{Reference table for mcnodes. If omitted or NULL nodes that are
present as columns in \code{data} will be created from the data.}

\item{data_keys}{Data structure and keys, defaults to set_data_keys()}

\item{match_keys}{Keys to match prev_mcmodule mcnodes and data by}

\item{keys}{Optional explicit keys for the input data (character vector)}

\item{overwrite_keys}{Logical or NULL. If NULL (default) it becomes TRUE when
data_keys is NULL or an empty list; otherwise FALSE.}
}
\value{
An mcmodule object containing data, expressions, and nodes
}
\description{
Takes a set of Monte Carlo model expressions, evaluates them, and creates an
mcmodule containing results and metadata.
}
\details{
\itemize{
\item mcstoc() and mcdata() may be used directly inside model expressions.
When these are used you should NOT explicitly supply nvariates, nvariates
will be inferred automatically as the number of rows in the input \code{data}.
Other arguments are preserved, for example specify \code{type = "0"} when
providing data without variability/uncertainty (see ?mcdata and ?mcstoc).
\item By design, mcmodule supports type = "V" (the default, with variability) and
type = "0" (no variability) nodes. Expressions that specify other node
types ("U" or "VU") are not fully supported and downstream compatibility is not
guaranteed.
\item An explicit \code{mctable} is optional but highly recommended. If no mctable is
provided, any model nodes that match column names in \code{data} will be built
from the data. If a \code{mctable} is provided and a node is not found there but
exists as a data column, a warning will be issued and the node will be created
from the data column.
\item Within expressions reference input mcnodes by their bare names (e.g.
column1). Do not use \code{data$column1} or \code{data["column1"]}.
}
}
\examples{
# Basic usage with single expression
# Build a quoted expression using mcnodes defined in mctable or built with 
# mcstoc()/mcdata within the expression (do NOT set nvariates, it is
# inferred from nrow(data) when evaluated by eval_module()).
expr_example <- quote({
  # Within-herd prevalence (assigned from a pre-built mcnode w_prev)
  inf_a <- w_prev

  # Estimate of clinic sensitivity 
  clinic_sensi <- mcstoc(runif, min = 0.6, max = 0.8)

  # Probability an infected animal is tested in origin and not detected 
  false_neg_a <- inf_a * test_origin * (1 - test_sensi) * (1 - clinic_sensi)

  # Probability an infected animal is not tested and not detected 
  no_test_a <- inf_a * (1 - test_origin) * (1 - clinic_sensi)

  # no_detect_a: total probability an infected animal is not detected
  no_detect_a <- false_neg_a + no_test_a
})

# Evaluate
eval_module(
  exp = expr_example, 
  data = imports_data, 
  mctable = imports_mctable, 
  data_keys = imports_data_keys
)
}
