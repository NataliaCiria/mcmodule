<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction • mcmodule</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mcmodule</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/mcmodule.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/intro.html">Introduction</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NataliaCiria/mcmodule/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="intro_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="intro_files/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="intro_files/vis-9.1.0/vis-network.min.js"></script><script src="intro_files/visNetwork-binding-2.1.4/visNetwork.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction</h1>
                        <h4 data-toc-skip class="author">Natalia
Ciria</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NataliaCiria/mcmodule/blob/main/vignettes/intro.Rmd" class="external-link"><code>vignettes/intro.Rmd</code></a></small>
      <div class="d-none name"><code>intro.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>This is a gentle and casual welcome to Monte Carlo risk analysis and
the use of <a href="https://nataliaciria.github.io/mcmodule/"><code>mcmodule</code></a>.
For a more formal approach you can read the package official <a href="https://nataliaciria.github.io/mcmodule/articles/mcmodule.html">vignette</a>.</p>
<p>I developed this new R package because I could not find any suitable
tools for creating complex risk analysis models with thousands of
parameters, hundreds of cases, dozens of scenarios, and multiple
pathways in R (or in any other software accessible to
epidemiologists).</p>
<p>Formally, <code>mcmodule</code> is a framework for building modular
Monte Carlo risk analysis models. It extends the capabilities of
<code>mc2d</code> to make working with multiple risk pathways, variates,
and scenarios easier. The package includes tools for creating stochastic
objects from data frames, visualizing results, and performing
uncertainty, sensitivity, and convergence analysis.</p>
<p>For me, <code>mcmodule</code> was a little set of custom functions
that was born out of necessity and grew out of obsession. Eventually,
the effort and lessons learned in building smooth, large-scale risk
analysis in R were so great that it was something I couldn’t keep just
for our <a href="https://github.com/VetEpi-UAB/farmrisk" class="external-link">farmR!SK</a>
project. Now, I hope this package can help other epidemiologists (and
risk modellers from other disciplines), not only to save a few hours of
work, but also to be ambitious and design complex risk pathways knowing
that it will be feasible to evaluate them in R.</p>
<div class="section level3">
<h3 id="risk-assessment">Risk assessment<a class="anchor" aria-label="anchor" href="#risk-assessment"></a>
</h3>
<p>This section provides a brief introduction to risk assessment in R.
Although this package is not intended for beginners in risk assessment,
it can help you understand the logic behind mcmodule and its
purpose.</p>
<div class="section level4">
<h4 id="a-simple-risk-assessment">A simple risk assessment<a class="anchor" aria-label="anchor" href="#a-simple-risk-assessment"></a>
</h4>
<p>Let’s imagine we want to buy a heifer from a friend. We know their
farm is infected with pathogen A, a disease that your farm is free from.
To reduce risk, we plan to perform a diagnostic test before bringing the
heifer to our farm. We want to calculate the probability of introducing
the disease if we purchase one heifer that tests negative.</p>
<p>Risk assessment is a technique to estimate the probability and impact
of an “adverse”<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Although in practice it is more commonly used to assess
adverse events (that’s why they’re called “risks”), these quantitative
techniques can obviously also be used to estimate the probability of any
event, judgements about whether it is adverse or not are not part of the
probabilistic calculations.&lt;/p&gt;"><sup>1</sup></a> event. It identifies the steps necessary
for the event to occur and assigns them a probability. In our case, we
have some uncertainty around the probability that an animal in a herd is
infected and around the test sensitivity, so we want to conduct a
probabilistic or stochastic risk assessment that can account for that
uncertainty.</p>
<p>The risk assessment for our cattle purchase can be performed using
base R <span class="citation">(<a href="#ref-base">2024</a>)</span>
random sampling functions, or <code>mc2d</code> <span class="citation">(<a href="#ref-mc2d">Pouillot and Delignette-Muller
2010</a>)</span>, a package provides additional probability
distributions (such as rpert) and other useful tools for analyzing
stochastic (Monte-Carlo) simulations.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mc2d</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n_iterations</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span></span>
<span><span class="co"># Within-herd prevalence</span></span>
<span><span class="va">w_prev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcstoc.html" class="external-link">mcstoc</a></span><span class="op">(</span><span class="va">runif</span>, min <span class="op">=</span> <span class="fl">0.15</span>, max <span class="op">=</span> <span class="fl">0.2</span>, </span>
<span>                 nsu <span class="op">=</span> <span class="va">n_iterations</span>, type<span class="op">=</span><span class="st">"U"</span><span class="op">)</span></span>
<span><span class="co"># Test sensitivity</span></span>
<span><span class="va">test_sensi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcstoc.html" class="external-link">mcstoc</a></span><span class="op">(</span><span class="va">rpert</span>, min <span class="op">=</span> <span class="fl">0.89</span>, mode <span class="op">=</span> <span class="fl">0.9</span>, max <span class="op">=</span> <span class="fl">0.91</span>, </span>
<span>                     nsu <span class="op">=</span> <span class="va">n_iterations</span>, type<span class="op">=</span><span class="st">"U"</span><span class="op">)</span></span>
<span><span class="co"># Probability an animal is tested in origin</span></span>
<span><span class="va">test_origin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fl">1</span>, type<span class="op">=</span><span class="st">"0"</span><span class="op">)</span> <span class="co">#Yes</span></span>
<span></span>
<span></span>
<span><span class="co"># EXPRESSIONS</span></span>
<span><span class="co"># Probability that an animal in an infected herd is infected (a = animal)</span></span>
<span><span class="va">inf</span> <span class="op">&lt;-</span> <span class="va">w_prev</span></span>
<span><span class="co"># Probability an animal is tested and is a false negative </span></span>
<span><span class="co"># (test specificity assumed to be 100%)</span></span>
<span><span class="va">false_neg</span> <span class="op">&lt;-</span> <span class="va">inf</span> <span class="op">*</span> <span class="va">test_origin</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_sensi</span><span class="op">)</span></span>
<span><span class="co"># Probability an animal is not tested</span></span>
<span><span class="va">no_test</span> <span class="op">&lt;-</span> <span class="va">inf</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_origin</span><span class="op">)</span></span>
<span><span class="co"># Probability an animal is not detected</span></span>
<span><span class="va">no_detect</span> <span class="op">&lt;-</span> <span class="va">false_neg</span> <span class="op">+</span> <span class="va">no_test</span></span>
<span></span>
<span><span class="va">mc_model</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mc.html" class="external-link">mc</a></span><span class="op">(</span><span class="va">w_prev</span>, <span class="va">inf</span>, <span class="va">test_origin</span>, <span class="va">test_sensi</span>, </span>
<span>             <span class="va">false_neg</span>, <span class="va">no_test</span>, <span class="va">no_detect</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># RESULT</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">mc_model</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">no_detect</span></span></code></pre></div>
<pre><code><span><span class="co">##   node    mode nsv   nsu nva variate    min   mean median    max Nas type outm</span></span>
<span><span class="co">## 1    x numeric   1 10000   1       1 0.0138 0.0175 0.0174 0.0218   0    U each</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="multiple-risk-assessments-at-once">Multiple risk assessments at once<a class="anchor" aria-label="anchor" href="#multiple-risk-assessments-at-once"></a>
</h4>
<p>In the previous example, we calculated the risk for one specific
case. However, we know that this farm is also positive for pathogen B,
so it would be also interesting to calculate the risk of introducing it
as well. Pathogen B has different within-herd prevalence and test
sensitivity than Pathogen A.</p>
<p>To estimate the risk for both pathogens with our previous models, we
could:</p>
<ul>
<li><p>Copy and paste the code twice with different parameters (against
all good coding practices)</p></li>
<li><p>Wrap the code in a function and call it twice using each
pathogen’s parameters as arguments</p></li>
<li><p>Create a loop</p></li>
</ul>
<p>While these options work, they become messy or computationally
intensive when the number of parameters or different situations to
simulate increases.</p>
<p>The package <code>mc2d</code> offers a clever solution to this
scalability problem: variates. In this package, parameters are stored as
<strong>mcnode</strong> class objects. These objects are arrays of
numbers that represent random variables and have three dimensions:
<strong>variability × uncertainty × variates</strong>.</p>
<p><img src="images/mcmodule_node_dimensions.png" fig-align="center"></p>
<p>In the previous example, our stochastic nodes only had uncertainty
dimension. However, we can now use the <strong>variates</strong>
dimension to calculate the risk of introduction of both pathogens at the
same time.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n_iterations</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span></span>
<span><span class="co"># Within-herd prevalence</span></span>
<span><span class="va">w_prev_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.15</span>, b <span class="op">=</span> <span class="fl">0.45</span><span class="op">)</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type<span class="op">=</span><span class="st">"0"</span><span class="op">)</span></span>
<span><span class="va">w_prev_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.2</span>, b <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type<span class="op">=</span><span class="st">"0"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">w_prev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcstoc.html" class="external-link">mcstoc</a></span><span class="op">(</span><span class="va">runif</span>, min <span class="op">=</span> <span class="va">w_prev_min</span>, max <span class="op">=</span> <span class="va">w_prev_max</span>, </span>
<span>                 nsu <span class="op">=</span> <span class="va">n_iterations</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type<span class="op">=</span><span class="st">"U"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test sensitivity</span></span>
<span><span class="va">test_sensi_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.89</span>, b <span class="op">=</span> <span class="fl">0.80</span><span class="op">)</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="va">test_sensi_mode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.9</span>, b <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="va">test_sensi_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.91</span>, b <span class="op">=</span> <span class="fl">0.90</span><span class="op">)</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_sensi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcstoc.html" class="external-link">mcstoc</a></span><span class="op">(</span><span class="va">rpert</span>, min <span class="op">=</span> <span class="va">test_sensi_min</span>, </span>
<span>                     mode <span class="op">=</span> <span class="va">test_sensi_mode</span>, max <span class="op">=</span> <span class="va">test_sensi_max</span>, </span>
<span>                     nsu <span class="op">=</span> <span class="va">n_iterations</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type<span class="op">=</span><span class="st">"U"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Probability an animal is tested in origin</span></span>
<span><span class="va">test_origin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type<span class="op">=</span><span class="st">"0"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># EXPRESSIONS</span></span>
<span><span class="co"># Probability that an animal in an infected herd is infected (a = animal)</span></span>
<span><span class="va">inf</span> <span class="op">&lt;-</span> <span class="va">w_prev</span></span>
<span><span class="co"># Probability an animal is tested and is a false negative </span></span>
<span><span class="co"># (test specificity assumed to be 100%)</span></span>
<span><span class="va">false_neg</span> <span class="op">&lt;-</span> <span class="va">inf</span> <span class="op">*</span> <span class="va">test_origin</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_sensi</span><span class="op">)</span></span>
<span><span class="co"># Probability an animal is not tested</span></span>
<span><span class="va">no_test</span> <span class="op">&lt;-</span> <span class="va">inf</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_origin</span><span class="op">)</span></span>
<span><span class="co"># Probability an animal is not detected</span></span>
<span><span class="va">no_detect</span> <span class="op">&lt;-</span> <span class="va">false_neg</span> <span class="op">+</span> <span class="va">no_test</span></span>
<span></span>
<span><span class="va">mc_model</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mc.html" class="external-link">mc</a></span><span class="op">(</span><span class="va">w_prev</span>, <span class="va">inf</span>, <span class="va">test_origin</span>, <span class="va">test_sensi</span>, </span>
<span>             <span class="va">false_neg</span>, <span class="va">no_test</span>, <span class="va">no_detect</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># RESULT</span></span>
<span><span class="va">no_detect</span></span></code></pre></div>
<pre><code><span><span class="co">##   node    mode nsv   nsu nva variate    min   mean median    max Nas type outm</span></span>
<span><span class="co">## 1    x numeric   1 10000   2       1 0.0139 0.0175 0.0174 0.0217   0    U each</span></span>
<span><span class="co">## 2    x numeric   1 10000   2       2 0.0477 0.0787 0.0783 0.1178   0    U each</span></span></code></pre>
<p>Instead of manually typing the parameter values, you can also use
columns from a data table in <code><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata()</a></code>. A useful template
for setting up risk analysis models using <code>mc2d</code>, with custom
functions to facilitate data manipulation and visualization, can be
found in this repository: <a href="https://github.com/NataliaCiria/risk_analysis_template" class="external-link uri">https://github.com/NataliaCiria/risk_analysis_template</a>.</p>
</div>
</div>
<div class="section level3">
<h3 id="when-to-use-mcmodule">When to use mcmodule?<a class="anchor" aria-label="anchor" href="#when-to-use-mcmodule"></a>
</h3>
<p>The <code>mc2d</code> multivariate approach works well for basic
multivariate risk analysis. However, if instead of purchasing one cow,
you’re dealing with multiple cattle purchases, from different farms,
across different pathogens, scenarios, and age categories, or modeling
multiple risk pathways with different what-if scenarios, this approach
becomes unwieldy.</p>
<p><code>mcmodule</code> addresses these challenges by providing
functions for <strong>multivariate operations</strong> and
<strong>modular management</strong> of the risk model. It automates the
process of creating mcnodes and assigns metadata to them (making it easy
to identify which variate corresponds to which data row). Thanks to this
mcnode metadata, it enables row-matching between nodes with different
variates, combines probabilities across variates, and calculates
multilevel trials. As your risk analysis grows, you can create separate
modules for different pathways, each with independent parameters,
expressions, and scenarios that can later be connected into a complete
model.</p>
<p>This package is particularly useful for:</p>
<ul>
<li><p><strong>Working with complex models</strong> that involve
multiple pathways, pathogens, or scenarios simultaneously</p></li>
<li><p><strong>Dealing with large parameter sets</strong> (hundreds or
thousands of parameters)</p></li>
<li><p><strong>Handling different numbers of variates</strong> across
different parts of your model that need to be combined</p></li>
<li><p><strong>Creating modular risk assessments</strong> where
different components need to be developed independently but later
integrated (for example in collaborative projects)</p></li>
<li><p><strong>Performing sophisticated sensitivity analyses</strong>
across multiple model components</p></li>
</ul>
<p>However, for simpler analyses, such as single pathway models,
exploratory work, small models with few parameters, one-off analyses or
learning risk assessment <code>mcmodule</code>’s additional structure
may be unnecessary.</p>
</div>
<div class="section level3">
<h3 id="installing-mcmodule">Installing mcmodule<a class="anchor" aria-label="anchor" href="#installing-mcmodule"></a>
</h3>
<p>Now let’s explore this new package! It’s about to be submitted to
CRAN, but since it’s not there yet, we’ll install it from GitHub
instead.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"NataliaCiria/mcmodule"</span><span class="op">)</span></span></code></pre></div>
<p>And we load the package in our R session. Easy-peasy, ready to
go!</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/NataliaCiria/mcmodule" class="external-link">mcmodule</a></span><span class="op">)</span></span></code></pre></div>
<p>Other recommended packages to load along with mcmodule are:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>     <span class="co"># Data manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>   <span class="co"># Plots</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span>    <span class="co"># Network analysis</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://datastorm-open.github.io/visNetwork/" class="external-link">visNetwork</a></span><span class="op">)</span><span class="co"># Interactive network visualization</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="building-an-mcmodule">Building an mcmodule<a class="anchor" aria-label="anchor" href="#building-an-mcmodule"></a>
</h2>
<p>To quickly understand the key components of an mcmodule, we’ll start
by building one using the animal imports example included in the
package. For a more detailed view of each component, refer to the <a href="https://nataliaciria.github.io/mcmodule/articles/mcmodule.html#model-elements">model
elements</a> section in the package vignette.</p>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>Let’s consider a scenario where we want to evaluate the risk of
introducing pathogen A and pathogen B into our region from animal
imports from different regions (north, south, east, and west). We have
gathered the following data:</p>
<ul>
<li>
<p><code>animal_imports</code>: number of animal imports with their
mean and standard deviation values per region, and the number of
exporting farms in each region.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">animal_imports</span></span></code></pre></div>
<pre><code><span><span class="co">##   origin farms_n animals_n_mean animals_n_sd</span></span>
<span><span class="co">## 1   nord       5            100            6</span></span>
<span><span class="co">## 2  south      10            130           10</span></span>
<span><span class="co">## 3   east       7            140           12</span></span></code></pre>
</li>
<li>
<p><code>prevalence_region</code>: estimates for both herd and
within-herd prevalence ranges for pathogens A and B, as well as an
indicator of how often tests are performed in origin</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prevalence_region</span></span></code></pre></div>
<pre><code><span><span class="co">##   pathogen origin h_prev_min h_prev_max w_prev_min w_prev_max test_origin</span></span>
<span><span class="co">## 1        a   nord       0.08       0.10       0.15        0.2   sometimes</span></span>
<span><span class="co">## 2        a  south       0.02       0.05       0.15        0.2   sometimes</span></span>
<span><span class="co">## 3        a   east       0.10       0.15       0.15        0.2       never</span></span>
<span><span class="co">## 4        b   nord       0.50       0.70       0.45        0.6      always</span></span>
<span><span class="co">## 5        b  south       0.25       0.30       0.37        0.4   sometimes</span></span>
<span><span class="co">## 6        b   east       0.30       0.50       0.45        0.6     unknown</span></span></code></pre>
</li>
<li>
<p><code>test_sensitivity</code>: estimates of test sensitivity
values for pathogen A and B</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_sensitivity</span></span></code></pre></div>
<pre><code><span><span class="co">##   pathogen test_sensi_min test_sensi_mode test_sensi_max</span></span>
<span><span class="co">## 1        a           0.89            0.90           0.91</span></span>
<span><span class="co">## 2        b           0.80            0.85           0.90</span></span></code></pre>
</li>
</ul>
<p>Now we will use <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">dplyr::left_join()</a></code> to create our imports
module data:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports_data</span><span class="op">&lt;-</span><span class="va">prevalence_region</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">animal_imports</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">test_sensitivity</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">pathogen</span>, <span class="va">origin</span>, <span class="va">test_origin</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(origin)`</span></span>
<span><span class="co">## Joining with `by = join_by(pathogen)`</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="data-keys">Data keys<a class="anchor" aria-label="anchor" href="#data-keys"></a>
</h3>
<p>From now on we will use only the merged <code>imports_data</code>
table. However, it is useful to understand which input dataset each
parameter comes from, as each dataset provides information for different
keys. In this context, keys are fields that (combined) uniquely identify
each row in a table. In our example:</p>
<ul>
<li><p><code>animal_imports</code> provided information by region of
<code>"origin"</code></p></li>
<li><p><code>prevalence_region</code> provided information by
<code>"pathogen"</code> and region of <code>"origin"</code></p></li>
<li><p><code>test_sensitivity</code> provided information by
<code>"pathogen"</code> only</p></li>
</ul>
<p>The resulting merged table, <code>imports_data</code>, will therefore
have two keys: <code>"pathogen"</code> and <code>"origin"</code>.
However, not all parameters will use both keys, for example,
<code>"test_sensi"</code> only has information by
<code>"pathogen"</code>. Knowing the keys for each parameter is crucial
when performing multivariate operations, such as <a href="https://nataliaciria.github.io/mcmodule/articles/intro.html#calculating-totals">calculating
totals</a>.</p>
<p>To make these relationships explicit in the model, we need to provide
the data keys. These are defined in a list with one element for each
input dataset, specifying both the columns and the keys for each
dataset.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports_data_keys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  animal_imports <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">animal_imports</span><span class="op">)</span>,</span>
<span>    keys <span class="op">=</span> <span class="st">"origin"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  prevalence_region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">prevalence_region</span><span class="op">)</span>,</span>
<span>    keys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pathogen"</span>, <span class="st">"origin"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  test_sensitivity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">test_sensitivity</span><span class="op">)</span>,</span>
<span>    keys <span class="op">=</span> <span class="st">"pathogen"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="mcnodes-table">mcnodes table<a class="anchor" aria-label="anchor" href="#mcnodes-table"></a>
</h3>
<p>With values and keys established, we still need some information to
build our stochastic parameters. The mcnode table specifies how to build
mcnodes from the data table. It specifies which parameters are included
in the model, the type of parameters (those with an mc_func are
stochastic), and what columns to look for in the data table to build
this mcnodes (the name of the mcnode, or another variable in the data
columns), as well as transformations that are usefull to encode
categorical data values into mcnodes that must always be numeric.</p>
<ul>
<li><p>mcnode: Name of the Monte Carlo node (required)</p></li>
<li><p>description: Description of the parameter</p></li>
<li><p>mc_func: Probability distribution</p></li>
<li><p>from_variable: Column name, if it comes from a column with a name
different to the mcnode</p></li>
<li><p>transformation: Transformation to be applied to the original
column values</p></li>
<li><p>sensi_analysis: Whether to include in sensitivity
analysis</p></li>
</ul>
<p>Here we have the <code>imports_mctable</code> for our example. While
the mctable can be hard-coded in R, it’s more efficient to prepare it in
a CSV or other external file. This approach also allows the table to be
included as part of the model documentation.</p>
<table class="table">
<colgroup>
<col width="7%">
<col width="33%">
<col width="3%">
<col width="6%">
<col width="43%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">mcnode</th>
<th align="left">description</th>
<th align="left">mc_func</th>
<th align="left">from_variable</th>
<th align="left">transformation</th>
<th align="left">sensi_analysis</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">h_prev</td>
<td align="left">Herd prevalence</td>
<td align="left">runif</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">w_prev</td>
<td align="left">Within herd prevalence</td>
<td align="left">runif</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">test_sensi</td>
<td align="left">Test sensitivity</td>
<td align="left">rpert</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">farms_n</td>
<td align="left">Number of farms exporting animals</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">animals_n</td>
<td align="left">Number of animals exported per farm</td>
<td align="left">rnorm</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">test_origin_unk</td>
<td align="left">Unknown probability of the animals being tested in
origin (true = unknown)</td>
<td align="left">NA</td>
<td align="left">test_origin</td>
<td align="left">value==“unknown”</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">test_origin</td>
<td align="left">Probability of the animals being tested in origin</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">ifelse(value == “always”, 1, ifelse(value ==
“sometimes”, 0.5, ifelse(value == “never”, 0, NA)))</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>The data table and the mctable must complement each other:</p>
<ul>
<li><p>mcnodes without a <code>mc_func</code> (like
<code>farms_n</code>), needs the matching column name
(<code>"farms_n"</code>) in the data table</p></li>
<li>
<p>mcnodes with an <code>mc_func</code>, you need <strong>columns
for each probability distribution argument in the</strong> <strong>data
table</strong>. For example:</p>
<ul>
<li><p><code>h_prev</code> with <code>runif</code> distribution requires
<code>"h_prev_min"</code> and <code>"h_prev_max"</code></p></li>
<li><p><code>animals_n</code> with <code>rnorm</code> distribution
requires <code>"animals_n_mean"</code> and
<code>"animals_n_sd"</code></p></li>
</ul>
</li>
</ul>
<p>For encoding categorical variables as mcnodes (or any other data
transformation), you can use any R code with <code>value</code> as a
placeholder for the mcnode name or column name (specified in
<code>from_variable</code>)</p>
</div>
<div class="section level3">
<h3 id="expressions">Expressions<a class="anchor" aria-label="anchor" href="#expressions"></a>
</h3>
<p>Finally, we need to write the model’s mathematical expression. This
expressions should ideally include only arithmetic operations, not R
functions (with some exceptions that will be covered later in “<a href="https://nataliaciria.github.io/mcmodule/articles/intro.html#tricks-and-tweaks">tricks
and tweaks</a>”). We’ll wrap them using <code><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote()</a></code> so they
aren’t executed immediately but stored for later evaluation with
<code>eval_model()</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports_exp</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="co"># Probability that an animal in an infected herd is infected (a = animal)</span></span>
<span>  <span class="va">inf</span> <span class="op">&lt;-</span> <span class="va">w_prev</span></span>
<span>  <span class="co"># Probability an animal is tested and is a false negative </span></span>
<span>  <span class="co"># (test specificity assumed to be 100%)</span></span>
<span>  <span class="va">false_neg</span> <span class="op">&lt;-</span> <span class="va">inf</span> <span class="op">*</span> <span class="va">test_origin</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_sensi</span><span class="op">)</span></span>
<span>  <span class="co"># Probability an animal is not tested</span></span>
<span>  <span class="va">no_test</span> <span class="op">&lt;-</span> <span class="va">inf</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_origin</span><span class="op">)</span></span>
<span>  <span class="co"># Probability an animal is not detected</span></span>
<span>  <span class="va">no_detect</span> <span class="op">&lt;-</span> <span class="va">false_neg</span> <span class="op">+</span> <span class="va">no_test</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="evaluating-an-mcmodule">Evaluating an mcmodule<a class="anchor" aria-label="anchor" href="#evaluating-an-mcmodule"></a>
</h3>
<p>With all components in place, we’re now ready to create our first
mcmodule using <code><a href="../reference/eval_module.html">eval_module()</a></code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/eval_module.html">eval_module</a></span><span class="op">(</span></span>
<span>  exp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>imports<span class="op">=</span><span class="va">imports_exp</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">imports_data</span>,</span>
<span>  mctable <span class="op">=</span> <span class="va">imports_mctable</span>,</span>
<span>  data_keys <span class="op">=</span> <span class="va">imports_data_keys</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## imports evaluated</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## mcmodule created (expressions: imports)</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">imports</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "mcmodule"</span></span></code></pre>
<p>An mcmodule is an S3 object class, and it is essentially a list that
contains all risk assessment components in a structured format.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">imports</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "data"      "exp"       "node_list" "modules"</span></span></code></pre>
<p>The mcmodule contains the input <code>data</code> and mathematical
expressions (<code>exp</code>) that ensure traceability. All input and
calculated parameters are stored in <code>node_list</code>. Each node
contains not only the mcnode itself but also important metadata: node
type (input or output), source dataset and columns, keys, calculation
method, and more. The specific metadata varies depending on the node’s
characteristics. Here are a few examples:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports</span><span class="op">$</span><span class="va">node_list</span><span class="op">$</span><span class="va">w_prev</span></span></code></pre></div>
<pre><code><span><span class="co">## $type</span></span>
<span><span class="co">## [1] "in_node"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $mc_func</span></span>
<span><span class="co">## [1] "runif"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $description</span></span>
<span><span class="co">## [1] "Within herd prevalence"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $inputs_col</span></span>
<span><span class="co">## [1] "w_prev_min" "w_prev_max"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $input_dataset</span></span>
<span><span class="co">## [1] "prevalence_region"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $keys</span></span>
<span><span class="co">## [1] "pathogen" "origin"  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $module</span></span>
<span><span class="co">## [1] "imports"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $mc_name</span></span>
<span><span class="co">## [1] "w_prev"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $mcnode</span></span>
<span><span class="co">##   node    mode  nsv nsu nva variate  min  mean median max Nas type outm</span></span>
<span><span class="co">## 1    x numeric 1001   1   6       1 0.15 0.175  0.175 0.2   0    V each</span></span>
<span><span class="co">## 2    x numeric 1001   1   6       2 0.15 0.175  0.173 0.2   0    V each</span></span>
<span><span class="co">## 3    x numeric 1001   1   6       3 0.15 0.176  0.176 0.2   0    V each</span></span>
<span><span class="co">## 4    x numeric 1001   1   6       4 0.45 0.524  0.524 0.6   0    V each</span></span>
<span><span class="co">## 5    x numeric 1001   1   6       5 0.37 0.385  0.385 0.4   0    V each</span></span>
<span><span class="co">## 6    x numeric 1001   1   6       6 0.45 0.525  0.525 0.6   0    V each</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $data_name</span></span>
<span><span class="co">## [1] "imports_data"</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports</span><span class="op">$</span><span class="va">node_list</span><span class="op">$</span><span class="va">no_detect</span></span></code></pre></div>
<pre><code><span><span class="co">## $node_exp</span></span>
<span><span class="co">## [1] "false_neg + no_test"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $type</span></span>
<span><span class="co">## [1] "out_node"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $inputs</span></span>
<span><span class="co">## [1] "false_neg" "no_test"  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $module</span></span>
<span><span class="co">## [1] "imports"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $mc_name</span></span>
<span><span class="co">## [1] "no_detect"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $keys</span></span>
<span><span class="co">## [1] "pathogen" "origin"  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $param</span></span>
<span><span class="co">## [1] "false_neg" "no_test"  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $mcnode</span></span>
<span><span class="co">##   node    mode  nsv nsu nva variate    min   mean median   max Nas type outm</span></span>
<span><span class="co">## 1    x numeric 1001   1   6       1 0.0823 0.0961 0.0962 0.111   0    V each</span></span>
<span><span class="co">## 2    x numeric 1001   1   6       2 0.0821 0.0960 0.0954 0.110   0    V each</span></span>
<span><span class="co">## 3    x numeric 1001   1   6       3 0.1501 0.1758 0.1758 0.200   0    V each</span></span>
<span><span class="co">## 4    x numeric 1001   1   6       4 0.0473 0.0789 0.0783 0.113   0    V each</span></span>
<span><span class="co">## 5    x numeric 1001   1   6       5 0.2056 0.2216 0.2216 0.237   0    V each</span></span>
<span><span class="co">## 6    x numeric 1001   1   6       6 0.4501 0.5250 0.5251 0.600   0    V each</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $data_name</span></span>
<span><span class="co">## [1] "imports_data"</span></span></code></pre>
<p>And now that we have an mcmodule, we can begin exploring its
possibilities!</p>
</div>
</div>
<div class="section level2">
<h2 id="working-with-an-mcmodule">Working with an mcmodule<a class="anchor" aria-label="anchor" href="#working-with-an-mcmodule"></a>
</h2>
<div class="section level3">
<h3 id="visualizing">Visualizing<a class="anchor" aria-label="anchor" href="#visualizing"></a>
</h3>
<p>We can visualize an mc_module with the mc_network() function. For
this you will need to have <code>igraph</code> <span class="citation">(<a href="#ref-igraph">Csardi and Nepusz
2006</a>)</span> and <code>visNetwork</code> <span class="citation">(<a href="#ref-visnetwork">Almende B. V. and Benoit Thieurmel
2025</a>)</span>installed.</p>
<p>In these visualizations, input datasets appear in blue, input columns
in dark-grey-blue, input mcnodes in grey, output mcnodes in green, and
total mcnodes (as we will see later) in orange. The numbers displayed
when clicked correspond to the first variate of each mcnode.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#TODO: why inf is not conected to no_test, false_neg??</span></span>
<span><span class="fu"><a href="../reference/mc_network.html">mc_network</a></span><span class="op">(</span><span class="va">imports</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:432.632880098888px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"nodes":{"id":["w_prev","test_origin","test_sensi","inf","false_neg","no_test","no_detect","w_prev_min","w_prev_max","imports_data","prevalence_region","test_sensi_min","test_sensi_mode","test_sensi_max","test_sensitivity"],"color":["#BDCCDB","#BDCCDB","#BDCCDB","#18BC9C","#18BC9C","#18BC9C","#18BC9C","#89A3BE","#89A3BE",null,null,"#89A3BE","#89A3BE","#89A3BE",null],"module":["imports","imports","imports","imports","imports","imports","imports","inputs_col","inputs_col","input_data","input_dataset","inputs_col","inputs_col","inputs_col","input_dataset"],"expression":["runif","runif","runif","w_prev","inf * test_origin * (1 - test_sensi)","inf * (1 - test_origin)","false_neg + no_test",null,null,null,null,null,null,null,null],"title":["<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>w_prev<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>17.51% (15.11%-19.86%)<br><\/strong>runif<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">w_prev_min<br> w_prev_max<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>test_origin<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.5<br><\/strong>runif<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">test_origin<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>test_sensi<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>89.96% (89.29%-90.7%)<br><\/strong>runif<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">test_sensi_min<br> test_sensi_mode<br> test_sensi_max<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>inf<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>17.51% (15.11%-19.86%)<br><\/strong>w_prev<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">w_prev<\/td>\n          <td style=\"width: 50%; text-align: center;\">w_prev<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>false_neg<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.87% (0.74%-1.03%)<br><\/strong>inf * test_origin * (1 - test_sensi)<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">test_origin<br> test_sensi<\/td>\n          <td style=\"width: 50%; text-align: center;\">test_origin<br> test_sensi<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_test<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>8.76% (7.55%-9.93%)<br><\/strong>inf * (1 - test_origin)<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">test_origin<\/td>\n          <td style=\"width: 50%; text-align: center;\">test_origin<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>9.62% (8.32%-10.92%)<br><\/strong>false_neg + no_test<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">false_neg<br> no_test<\/td>\n          <td style=\"width: 50%; text-align: center;\">false_neg<br> no_test<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>w_prev_min<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">inputs_col<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.15<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">imports_data<br> prevalence_region<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>w_prev_max<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">inputs_col<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.2<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">imports_data<br> prevalence_region<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>imports_data<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">input_data<\/span><\/p>\n    <p style=\"text-align: center;\"><strong><br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\"><br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>prevalence_region<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">input_dataset<\/span><\/p>\n    <p style=\"text-align: center;\"><strong><br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\"><br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>test_sensi_min<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">inputs_col<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.89<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">imports_data<br> test_sensitivity<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>test_sensi_mode<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">inputs_col<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.9<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">imports_data<br> test_sensitivity<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>test_sensi_max<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">inputs_col<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.91<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">imports_data<br> test_sensitivity<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>test_sensitivity<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">input_dataset<\/span><\/p>\n    <p style=\"text-align: center;\"><strong><br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\"><br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>"],"label":["w_prev","test_origin","test_sensi","inf","false_neg","no_test","no_detect","w_prev_min","w_prev_max","imports_data","prevalence_region","test_sensi_min","test_sensi_mode","test_sensi_max","test_sensitivity"],"x":[-0.6,-1,0.6000000000000001,-0.6,0.2,-1,-0.2,-0.6,-0.2,0,-0.2,0.2,0.6000000000000001,1,0.2],"y":[0.2,-0.2,0.2,0.6000000000000001,0.6000000000000001,0.2,1,-0.2,-0.2,-0.6,-1,-0.2,-0.2,-0.2,-1]},"edges":{"from":["w_prev_min","w_prev_max","prevalence_region","imports_data","imports_data","test_origin","imports_data","test_sensi_min","test_sensi_mode","test_sensi_max","test_sensitivity","imports_data","imports_data","imports_data","w_prev","test_origin","test_sensi","test_origin","false_neg","no_test"],"to":["w_prev","w_prev","imports_data","w_prev_min","w_prev_max","test_origin","test_origin","test_sensi","test_sensi","test_sensi","imports_data","test_sensi_min","test_sensi_mode","test_sensi_max","inf","false_neg","false_neg","no_test","no_detect","no_detect"],"id":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"arrows":"to","smooth":false},"physics":{"enabled":false},"interaction":{"dragNodes":true,"zoomSpeed":1}},"groups":null,"width":"100%","height":null,"idselection":{"enabled":true,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":true,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false,"variable":"module","main":"Select by module","values":["imports","input_data","input_dataset","inputs_col"]},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":2,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":false,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="sec-calculating-totals">Summarizing<a class="anchor" aria-label="anchor" href="#sec-calculating-totals"></a>
</h3>
<p>In the imports mcmodule, we can already see the raw mcnode results
for the probability of an imported animal not being detected
(<code>no_detect</code>). However, it’s difficult to determine which
pathogen or region these results refer to. The <code><a href="../reference/mc_summary.html">mc_summary()</a></code>
function solves this problem by linking mcnode results with their key
columns in the data.</p>
<blockquote>
<p>Note that while the printed summary looks similar to the raw mcnode,
it’s actually just a dataframe containing statistical measures, whereas
the actual mcnode is a large array of numbers with dimensions
(uncertainty × 1 × variates),</p>
</blockquote>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mc_summary.html">mc_summary</a></span><span class="op">(</span>mcmodule <span class="op">=</span> <span class="va">imports</span>, mc_name <span class="op">=</span> <span class="st">"no_detect"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     mc_name pathogen origin       mean          sd        Min       2.5%</span></span>
<span><span class="co">## 1 no_detect        a   nord 0.09606117 0.007846092 0.08229964 0.08315677</span></span>
<span><span class="co">## 2 no_detect        a  south 0.09600480 0.007853480 0.08211744 0.08335069</span></span>
<span><span class="co">## 3 no_detect        a   east 0.17576742 0.014232780 0.15012421 0.15143865</span></span>
<span><span class="co">## 4 no_detect        b   nord 0.07893257 0.011945867 0.04733962 0.05755650</span></span>
<span><span class="co">## 5 no_detect        b  south 0.22158127 0.006342677 0.20562155 0.21003466</span></span>
<span><span class="co">## 6 no_detect        b   east 0.52501566 0.044450307 0.45010788 0.45180481</span></span>
<span><span class="co">##          25%        50%        75%     97.5%       Max  nsv Na's</span></span>
<span><span class="co">## 1 0.08935080 0.09624474 0.10277116 0.1091880 0.1106308 1001    0</span></span>
<span><span class="co">## 2 0.08962080 0.09541026 0.10270101 0.1094114 0.1103462 1001    0</span></span>
<span><span class="co">## 3 0.16410730 0.17582400 0.18797380 0.1986464 0.1999425 1001    0</span></span>
<span><span class="co">## 4 0.06985123 0.07826653 0.08704084 0.1028250 0.1130751 1001    0</span></span>
<span><span class="co">## 5 0.21693959 0.22159777 0.22614771 0.2338717 0.2372087 1001    0</span></span>
<span><span class="co">## 6 0.48700830 0.52505400 0.56319271 0.5974721 0.5999797 1001    0</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="calculating-totals">Calculating totals<a class="anchor" aria-label="anchor" href="#calculating-totals"></a>
</h3>
<div class="section level4">
<h4 id="single-level-trials">Single-level trials<a class="anchor" aria-label="anchor" href="#single-level-trials"></a>
</h4>
<p>In <code>imports</code>, we have the probability that an infected
animal from an infected farm goes undetected (<code>"no_detect"</code>).
When all animals (in a variate) have the same probability, we can use
the total number of animals selected per farm (<code>"animals_n"</code>)
as the number of trials (<code>trials_n</code>) to determine the
probability that at least one infected animal from one farm is not
detected (no_detect_set).</p>
<blockquote>
<p>Note that while <code>"animals_n"</code> is not found as an mcnode in
<code>imports</code> (it was not used in <code>imports$exp</code>), it
can be automatically generated in <code><a href="../reference/trial_totals.html">trial_totals()</a></code> because
it’s included in <code>imports_mctable</code> and the required data
exists in <code>imports$data</code>.</p>
</blockquote>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Probability of at least one imported animal from an infected herd is not detected </span></span>
<span><span class="va">imports</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trial_totals.html">trial_totals</a></span><span class="op">(</span></span>
<span>  mcmodule <span class="op">=</span> <span class="va">imports</span>,</span>
<span>  mc_names <span class="op">=</span> <span class="st">"no_detect"</span>,</span>
<span>  trials_n <span class="op">=</span> <span class="st">"animals_n"</span>,</span>
<span>  mctable <span class="op">=</span> <span class="va">imports_mctable</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note that this function returns an mcmodule with some additional
nodes. Total nodes have special metadata fields, and always include a
summary by default.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports</span><span class="op">$</span><span class="va">node_list</span><span class="op">$</span><span class="va">no_detect_set</span><span class="op">$</span><span class="va">summary</span></span></code></pre></div>
<pre><code><span><span class="co">##         mc_name pathogen origin      mean           sd       Min      2.5%</span></span>
<span><span class="co">## 1 no_detect_set        a   nord 0.9999321 7.013890e-05 0.9994040 0.9997494</span></span>
<span><span class="co">## 2 no_detect_set        a  south 0.9999946 9.023932e-06 0.9999207 0.9999693</span></span>
<span><span class="co">## 3 no_detect_set        a   east 1.0000000 7.143640e-10 1.0000000 1.0000000</span></span>
<span><span class="co">## 4 no_detect_set        b   nord 0.9993863 9.111167e-04 0.9878926 0.9969435</span></span>
<span><span class="co">## 5 no_detect_set        b  south 1.0000000 8.284954e-13 1.0000000 1.0000000</span></span>
<span><span class="co">## 6 no_detect_set        b   east 1.0000000 0.000000e+00 1.0000000 1.0000000</span></span>
<span><span class="co">##         25%       50%       75%     97.5%       Max  nsv Na's</span></span>
<span><span class="co">## 1 0.9999111 0.9999592 0.9999798 0.9999942 0.9999990 1001    0</span></span>
<span><span class="co">## 2 0.9999940 0.9999979 0.9999993 0.9999999 1.0000000 1001    0</span></span>
<span><span class="co">## 3 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1001    0</span></span>
<span><span class="co">## 4 0.9992577 0.9997108 0.9998988 0.9999820 0.9999967 1001    0</span></span>
<span><span class="co">## 5 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1001    0</span></span>
<span><span class="co">## 6 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1001    0</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="multilevel-trials">Multilevel trials<a class="anchor" aria-label="anchor" href="#multilevel-trials"></a>
</h4>
<div class="section level5">
<h5 id="simple-multilevel">Simple multilevel<a class="anchor" aria-label="anchor" href="#simple-multilevel"></a>
</h5>
<p>When considering animals (trials_n) from different farms (subset_n),
we must account for both the farm’s probability of being infected
(subset_p) and the individual animal’s probability of being infected
(trial_p).</p>
<p><img src="images/mcmodule_multilevel_trial_drawing.png"></p>
<p><img src="images/mcmodule_multilevel_trial_diagram.png"></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Probability of at least one animal from at least one herd being is not detected (probability of a herd being infected: h_prev)</span></span>
<span><span class="va">imports</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trial_totals.html">trial_totals</a></span><span class="op">(</span></span>
<span>  mcmodule <span class="op">=</span> <span class="va">imports</span>,</span>
<span>  mc_names <span class="op">=</span> <span class="st">"no_detect"</span>,</span>
<span>  trials_n <span class="op">=</span> <span class="st">"animals_n"</span>,</span>
<span>  subsets_n <span class="op">=</span> <span class="st">"farms_n"</span>,</span>
<span>  subsets_p <span class="op">=</span> <span class="st">"h_prev"</span>,</span>
<span>  mctable <span class="op">=</span> <span class="va">imports_mctable</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Result</span></span>
<span><span class="va">imports</span><span class="op">$</span><span class="va">node_list</span><span class="op">$</span><span class="va">no_detect_set</span></span></code></pre></div>
<pre><code><span><span class="co">## $mcnode</span></span>
<span><span class="co">##   node    mode  nsv nsu nva variate   min  mean median   max Nas type outm</span></span>
<span><span class="co">## 1    x numeric 1001   1   6       1 0.341 0.375  0.375 0.409   0    V each</span></span>
<span><span class="co">## 2    x numeric 1001   1   6       2 0.183 0.300  0.301 0.401   0    V each</span></span>
<span><span class="co">## 3    x numeric 1001   1   6       3 0.522 0.603  0.601 0.679   0    V each</span></span>
<span><span class="co">## 4    x numeric 1001   1   6       4 0.969 0.988  0.990 0.998   0    V each</span></span>
<span><span class="co">## 5    x numeric 1001   1   6       5 0.944 0.959  0.959 0.972   0    V each</span></span>
<span><span class="co">## 6    x numeric 1001   1   6       6 0.918 0.967  0.972 0.992   0    V each</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $param</span></span>
<span><span class="co">## [1] "no_detect" "animals_n" "farms_n"   "h_prev"   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $inputs</span></span>
<span><span class="co">## [1] "no_detect" "animals_n" "farms_n"   "h_prev"   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $description</span></span>
<span><span class="co">## [1] "Probability of at least one no_detect in a set (set)"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $node_expression</span></span>
<span><span class="co">## [1] "1-(1-h_prev*(1-(1-no_detect)^animals_n))^farms_n"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $type</span></span>
<span><span class="co">## [1] "total"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $module</span></span>
<span><span class="co">## [1] "imports"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $keys</span></span>
<span><span class="co">## [1] "pathogen" "origin"  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $scenario</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $data_name</span></span>
<span><span class="co">## [1] "imports_data"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $prefix</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $total_type</span></span>
<span><span class="co">## [1] "multilevel set prob"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $summary</span></span>
<span><span class="co">##         mc_name pathogen origin      mean          sd       Min      2.5%</span></span>
<span><span class="co">## 1 no_detect_set        a   nord 0.3750658 0.019423805 0.3409096 0.3426622</span></span>
<span><span class="co">## 2 no_detect_set        a  south 0.2996147 0.062082135 0.1831011 0.1880185</span></span>
<span><span class="co">## 3 no_detect_set        a   east 0.6033211 0.044910761 0.5223697 0.5281263</span></span>
<span><span class="co">## 4 no_detect_set        b   nord 0.9879346 0.008092032 0.9685386 0.9700096</span></span>
<span><span class="co">## 5 no_detect_set        b  south 0.9591725 0.008198048 0.9436984 0.9446557</span></span>
<span><span class="co">## 6 no_detect_set        b   east 0.9666202 0.020854527 0.9178026 0.9227233</span></span>
<span><span class="co">##         25%       50%       75%     97.5%       Max  nsv Na's</span></span>
<span><span class="co">## 1 0.3584187 0.3754377 0.3919736 0.4074487 0.4093251 1001    0</span></span>
<span><span class="co">## 2 0.2502976 0.3010584 0.3531750 0.3983723 0.4010640 1001    0</span></span>
<span><span class="co">## 3 0.5654920 0.6014358 0.6445998 0.6758861 0.6789184 1001    0</span></span>
<span><span class="co">## 4 0.9820674 0.9903868 0.9947567 0.9972808 0.9975589 1001    0</span></span>
<span><span class="co">## 5 0.9519908 0.9594851 0.9664197 0.9713592 0.9717380 1001    0</span></span>
<span><span class="co">## 6 0.9515323 0.9719872 0.9843585 0.9916945 0.9921818 1001    0</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="working-with-multiple-mcmodules">Working with multiple mcmodules<a class="anchor" aria-label="anchor" href="#working-with-multiple-mcmodules"></a>
</h2>
<div class="section level3">
<h3 id="inputs-from-previous-mcmodules">Inputs from previous mcmodules<a class="anchor" aria-label="anchor" href="#inputs-from-previous-mcmodules"></a>
</h3>
<p>Now that we know the probability of an infected imported animal not
being detected, we want to estimate the probability that an imported
animal ends up infecting another animal via direct contact</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#  Create pathogen data table</span></span>
<span><span class="va">transmission_data</span>  <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pathogen<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"b"</span><span class="op">)</span>,</span>
<span>                            inf_dc_min<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.3</span><span class="op">)</span>,</span>
<span>                            inf_dc_max<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.08</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">transmission_data_keys</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>transmission_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pathogen"</span>, <span class="st">"inf_dc_min"</span>,<span class="st">"inf_dc_max"</span><span class="op">)</span>,</span>
<span>                                         keys<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pathogen"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">transmission_mctable</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>mcnode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"inf_dc"</span><span class="op">)</span>,</span>
<span>                               description <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Probability of infection via direct contact"</span><span class="op">)</span>,</span>
<span>                               mc_func <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"runif"</span><span class="op">)</span>,</span>
<span>                               from_variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>                               transformation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>                               sensi_analysis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dir_contact_exp</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">dir_contact</span> <span class="op">&lt;-</span> <span class="va">no_detect</span> <span class="op">*</span> <span class="va">inf_dc</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">transmission</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eval_module.html">eval_module</a></span><span class="op">(</span></span>
<span>  exp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>dir_contact <span class="op">=</span> <span class="va">dir_contact_exp</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">transmission_data</span>,</span>
<span>  mctable <span class="op">=</span><span class="va">transmission_mctable</span>,</span>
<span>  data_keys <span class="op">=</span> <span class="va">transmission_data_keys</span>,</span>
<span>  prev_mcmodule <span class="op">=</span> <span class="va">imports</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Group by: pathogen</span></span></code></pre>
<pre><code><span><span class="co">## no_detect prev dim: [1001, 1, 6], new dim: [1001, 1, 6], 0 null matches</span></span></code></pre>
<pre><code><span><span class="co">## data prev dim: [2, 3], new dim: [6, 3], 0 null matches</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## dir_contact evaluated</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## mcmodule created (expressions: dir_contact)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="combining-mcmodules">Combining mcmodules<a class="anchor" aria-label="anchor" href="#combining-mcmodules"></a>
</h3>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">intro</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/combine_modules.html">combine_modules</a></span><span class="op">(</span><span class="va">imports</span>,<span class="va">transmission</span><span class="op">)</span></span>
<span><span class="co">#intro&lt;-at_least_one(intro, c("no_detect","dir_contact"), name="total")</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="analysing-mcmodule-models">Analysing mcmodule models<a class="anchor" aria-label="anchor" href="#analysing-mcmodule-models"></a>
</h2>
<div class="section level3">
<h3 id="convergence-analysis">
<strong>Convergence</strong> analysis<a class="anchor" aria-label="anchor" href="#convergence-analysis"></a>
</h3>
<p>Checks if all variates in all parameters converge in the uncertainty
dimensions for the number of simulations performed.</p>
</div>
<div class="section level3">
<h3 id="sensitivity-analysis">Sensitivity analysis<a class="anchor" aria-label="anchor" href="#sensitivity-analysis"></a>
</h3>
<p>Parameters included specified in the mctable.</p>
<div class="section level4">
<h4 id="relative-change">Relative Change<a class="anchor" aria-label="anchor" href="#relative-change"></a>
</h4>
</div>
<div class="section level4">
<h4 id="spearman-correlation">
<strong>Spearman Correlation</strong><a class="anchor" aria-label="anchor" href="#spearman-correlation"></a>
</h4>
</div>
</div>
</div>
<div class="section level2">
<h2 id="sec-tricks-and-tweaks">Tricks and tweaks<a class="anchor" aria-label="anchor" href="#sec-tricks-and-tweaks"></a>
</h2>
<div class="section level3">
<h3 id="remove-mcnode-nas">Remove mcnode NAs<a class="anchor" aria-label="anchor" href="#remove-mcnode-nas"></a>
</h3>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_mcnode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcstoc.html" class="external-link">mcstoc</a></span><span class="op">(</span><span class="va">runif</span>,</span>
<span>               min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">0.2</span>, <span class="op">-</span><span class="cn">Inf</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"0"</span>, nvariates <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>               max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">0.3</span>, <span class="cn">Inf</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"0"</span>, nvariates <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>               nvariates <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in (function (n, min = 0, max = 1) : NAs produced</span></span></code></pre>
<pre><code><span><span class="co">## Warning in (function (n, min = 0, max = 1) : NAs produced</span></span></code></pre>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Replace NA and Inf with 0</span></span>
<span><span class="va">clean_mcnode</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcnode_na_rm.html">mcnode_na_rm</a></span><span class="op">(</span><span class="va">sample_mcnode</span><span class="op">)</span></span></code></pre></div>
<p>Useful to include in expressions were there is a division with a
denominator can potentially be 0 and it will return <code>Inf</code> or
<code>NaN</code>, but we actually want that parameter to be 0.</p>
</div>
<div class="section level3">
<h3 id="include-functions-in-expressions">Include functions in expressions<a class="anchor" aria-label="anchor" href="#include-functions-in-expressions"></a>
</h3>
</div>
<div class="section level3">
<h3 id="some-functions-that-can-be-used-without-mcmodules">Some functions that can be used without mcmodules<a class="anchor" aria-label="anchor" href="#some-functions-that-can-be-used-without-mcmodules"></a>
</h3>
<p>mc_summary with data and mcmodule</p>
<p>create_mcnodes</p>
</div>
</div>
<div class="section level2">
<h2 id="recommended-workflow">Recommended workflow<a class="anchor" aria-label="anchor" href="#recommended-workflow"></a>
</h2>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-visnetwork" class="csl-entry">
Almende B. V., and Benoit Thieurmel. 2025. <span>“Visnetwork: Network
Visualization Using ’Vis. <span>Js</span>’ Library.”</span> <a href="https://cran.r-project.org/web/packages/visNetwork/index.html" class="external-link">https://cran.r-project.org/web/packages/visNetwork/index.html</a>.
</div>
<div id="ref-igraph" class="csl-entry">
Csardi, Gabor, and Tamas Nepusz. 2006. <span>“The Igraph Software
Package for Complex Network Research”</span> Complex Systems: 1695. <a href="https://igraph.org" class="external-link">https://igraph.org</a>.
</div>
<div id="ref-mc2d" class="csl-entry">
Pouillot, R., and M.-L. Delignette-Muller. 2010. <span>“Evaluating
Variability and Uncertainty in Microbial Quantitative Risk Assessment
Using Two r Packages”</span> 142: 330–40.
</div>
<div id="ref-base" class="csl-entry">
R Core Team. 2024. <span>“R: A Language and Environment for Statistical
Computing.”</span> <a href="https://www.R-project.org/" class="external-link">https://www.R-project.org/</a>.
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Natalia Ciria.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
