<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>An Introduction to Modular Monte-Carlo Risk Analysis with mcmodule • mcmodule</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="An Introduction to Modular Monte-Carlo Risk Analysis with mcmodule">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mcmodule</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/mcmodule.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/intro.html">An Introduction to Modular Monte-Carlo Risk Analysis with mcmodule</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NataliaCiria/mcmodule/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="intro_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="intro_files/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="intro_files/vis-9.1.0/vis-network.min.js"></script><script src="intro_files/visNetwork-binding-2.1.4/visNetwork.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>An Introduction to Modular Monte-Carlo Risk Analysis with mcmodule</h1>
                        <h4 data-toc-skip class="author">Natalia
Ciria</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NataliaCiria/mcmodule/blob/main/vignettes/intro.Rmd" class="external-link"><code>vignettes/intro.Rmd</code></a></small>
      <div class="d-none name"><code>intro.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="sec-introduction">Introduction<a class="anchor" aria-label="anchor" href="#sec-introduction"></a>
</h2>
<p>This is a gentle and casual welcome to the wonders of modular Monte
Carlo risk analysis and the use of <a href="https://nataliaciria.github.io/mcmodule/"><code>mcmodule</code></a>.
For a more formal approach, I invite you to read the package official <a href="https://nataliaciria.github.io/mcmodule/articles/mcmodule.html">vignette</a>.</p>
<p>I developed this new R package because of the lack of suitable tools
to handle complex risk analysis models, with thousands of parameters,
hundreds of cases, dozens of scenarios, and several pathways (like <a href="https://github.com/VetEpi-UAB/farmrisk" class="external-link">farmR!SK</a>).</p>
<p><code>mcmodule</code> is a framework for building modular Monte Carlo
risk analysis models. It extends the capabilities of <code>mc2d</code>
to make working with multiple risk pathways, variates, and scenarios
easier. The package includes tools for creating stochastic objects from
data frames, visualizing results, and performing uncertainty,
sensitivity, and convergence analysis.</p>
<div class="section level3">
<h3 id="a-simple-risk-assessment">A simple risk assessment<a class="anchor" aria-label="anchor" href="#a-simple-risk-assessment"></a>
</h3>
<p>Let’s imagine we want to buy a heifer from a friend. We know their
farm is infected with pathogen A, a disease that your farm is free from.
To reduce risk, we plan to perform a diagnostic test before bringing the
heifer to our farm. We want to calculate the probability of introducing
the disease if we purchase one heifer that tests negative.</p>
<p>This risk assessment can be performed using <strong>base R</strong>
random sampling functions:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n_iterations</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span></span>
<span><span class="co"># PARAMETERS</span></span>
<span><span class="co"># Within-herd prevalence</span></span>
<span><span class="va">w_prev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_iterations</span>, min <span class="op">=</span> <span class="fl">0.15</span>, max <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="co"># Test sensitivity</span></span>
<span><span class="va">test_sensi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_iterations</span>, min <span class="op">=</span> <span class="fl">0.89</span>, max <span class="op">=</span> <span class="fl">0.91</span><span class="op">)</span></span>
<span><span class="co"># Probability an animal is tested in origin</span></span>
<span><span class="va">test_origin</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># Yes</span></span>
<span></span>
<span><span class="co"># EXPRESSIONS</span></span>
<span><span class="co"># Probability that an animal in an infected herd is infected (a = animal)</span></span>
<span><span class="va">inf</span> <span class="op">&lt;-</span> <span class="va">w_prev</span></span>
<span><span class="co"># Probability an animal is tested and is a false negative</span></span>
<span><span class="co"># (test specificity assumed to be 100%)</span></span>
<span><span class="va">false_neg</span> <span class="op">&lt;-</span> <span class="va">inf</span> <span class="op">*</span> <span class="va">test_origin</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_sensi</span><span class="op">)</span></span>
<span><span class="co"># Probability an animal is not tested</span></span>
<span><span class="va">no_test</span> <span class="op">&lt;-</span> <span class="va">inf</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_origin</span><span class="op">)</span></span>
<span><span class="co"># Probability an animal is not detected</span></span>
<span><span class="va">no_detect</span> <span class="op">&lt;-</span> <span class="va">false_neg</span> <span class="op">+</span> <span class="va">no_test</span></span>
<span></span>
<span><span class="co"># RESULT</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">no_detect</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">## 0.01353 0.01617 0.01743 0.01750 0.01878 0.02193</span></span></code></pre>
<p>A similar approach can be implemented with <code>mc2d</code> <span class="citation">(<a href="#ref-mc2d">Pouillot and Delignette-Muller
2010</a>)</span>. This package provides additional probability
distributions (such as rpert) and other useful tools for analysing Monte
Carlo simulations.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mc2d</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n_iterations</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span></span>
<span><span class="co"># Within-herd prevalence</span></span>
<span><span class="va">w_prev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcstoc.html" class="external-link">mcstoc</a></span><span class="op">(</span><span class="va">runif</span>, min <span class="op">=</span> <span class="fl">0.15</span>, max <span class="op">=</span> <span class="fl">0.2</span>, </span>
<span>                 nsu <span class="op">=</span> <span class="va">n_iterations</span>, type<span class="op">=</span><span class="st">"U"</span><span class="op">)</span></span>
<span><span class="co"># Test sensitivity</span></span>
<span><span class="va">test_sensi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcstoc.html" class="external-link">mcstoc</a></span><span class="op">(</span><span class="va">rpert</span>, min <span class="op">=</span> <span class="fl">0.89</span>, mode <span class="op">=</span> <span class="fl">0.9</span>, max <span class="op">=</span> <span class="fl">0.91</span>, </span>
<span>                     nsu <span class="op">=</span> <span class="va">n_iterations</span>, type<span class="op">=</span><span class="st">"U"</span><span class="op">)</span></span>
<span><span class="co"># Probability an animal is tested in origin</span></span>
<span><span class="va">test_origin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fl">1</span>, type<span class="op">=</span><span class="st">"0"</span><span class="op">)</span> <span class="co">#Yes</span></span>
<span></span>
<span></span>
<span><span class="co"># EXPRESSIONS</span></span>
<span><span class="co"># Probability that an animal in an infected herd is infected (a = animal)</span></span>
<span><span class="va">inf</span> <span class="op">&lt;-</span> <span class="va">w_prev</span></span>
<span><span class="co"># Probability an animal is tested and is a false negative </span></span>
<span><span class="co"># (test specificity assumed to be 100%)</span></span>
<span><span class="va">false_neg</span> <span class="op">&lt;-</span> <span class="va">inf</span> <span class="op">*</span> <span class="va">test_origin</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_sensi</span><span class="op">)</span></span>
<span><span class="co"># Probability an animal is not tested</span></span>
<span><span class="va">no_test</span> <span class="op">&lt;-</span> <span class="va">inf</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_origin</span><span class="op">)</span></span>
<span><span class="co"># Probability an animal is not detected</span></span>
<span><span class="va">no_detect</span> <span class="op">&lt;-</span> <span class="va">false_neg</span> <span class="op">+</span> <span class="va">no_test</span></span>
<span></span>
<span><span class="va">mc_model</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mc.html" class="external-link">mc</a></span><span class="op">(</span><span class="va">w_prev</span>, <span class="va">inf</span>, <span class="va">test_origin</span>, <span class="va">test_sensi</span>, </span>
<span>             <span class="va">false_neg</span>, <span class="va">no_test</span>, <span class="va">no_detect</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># RESULT</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">mc_model</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">no_detect</span></span></code></pre></div>
<pre><code><span><span class="co">##   node    mode nsv   nsu nva variate    min   mean median    max Nas type outm</span></span>
<span><span class="co">## 1    x numeric   1 10000   1       1 0.0138 0.0175 0.0174 0.0218   0    U each</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="multiple-risk-assessments-at-once">Multiple risk assessments at once<a class="anchor" aria-label="anchor" href="#multiple-risk-assessments-at-once"></a>
</h3>
<p>In the previous example, we calculated the risk for one specific
case. However, we know that this farm is also positive for pathogen B,
so it would be also interesting to calculate the risk of introducing it
as well. Pathogen B has different within-herd prevalence and test
sensitivity than Pathogen A.</p>
<p>To estimate the risk for both pathogens with our previous models, we
could:</p>
<ul>
<li><p>Copy and paste the code twice with different parameters (against
all good coding practices)</p></li>
<li><p>Wrap the code in a function and call it twice using each
pathogen’s parameters as arguments</p></li>
<li><p>Create a loop</p></li>
</ul>
<p>While these options work, they become messy or computationally
intensive when the number of parameters or different situations to
simulate increases.</p>
<p>The package <code>mc2d</code> offers a clever solution to this
scalability problem: variates. In this package, parameters are stored as
<strong>mcnode</strong> class objects. These objects are arrays of
numbers that represent random variables and have three dimensions:
<strong>variability × uncertainty × variates</strong>.</p>
<p><img src="images/mcmodule_node_dimensions.png" fig-align="center"></p>
<p>In the previous example, our stochastic nodes only had uncertainty
dimension. However, we can now use the <strong>variates</strong>
dimension to calculate the risk of introduction of both pathogens at the
same time.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n_iterations</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span></span>
<span><span class="co"># Within-herd prevalence</span></span>
<span><span class="va">w_prev_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.15</span>, b <span class="op">=</span> <span class="fl">0.45</span><span class="op">)</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type<span class="op">=</span><span class="st">"0"</span><span class="op">)</span></span>
<span><span class="va">w_prev_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.2</span>, b <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type<span class="op">=</span><span class="st">"0"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">w_prev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcstoc.html" class="external-link">mcstoc</a></span><span class="op">(</span><span class="va">runif</span>, min <span class="op">=</span> <span class="va">w_prev_min</span>, max <span class="op">=</span> <span class="va">w_prev_max</span>, </span>
<span>                 nsu <span class="op">=</span> <span class="va">n_iterations</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type<span class="op">=</span><span class="st">"U"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test sensitivity</span></span>
<span><span class="va">test_sensi_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.89</span>, b <span class="op">=</span> <span class="fl">0.80</span><span class="op">)</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="va">test_sensi_mode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.9</span>, b <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="va">test_sensi_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.91</span>, b <span class="op">=</span> <span class="fl">0.90</span><span class="op">)</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_sensi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcstoc.html" class="external-link">mcstoc</a></span><span class="op">(</span><span class="va">rpert</span>, min <span class="op">=</span> <span class="va">test_sensi_min</span>, </span>
<span>                     mode <span class="op">=</span> <span class="va">test_sensi_mode</span>, max <span class="op">=</span> <span class="va">test_sensi_max</span>, </span>
<span>                     nsu <span class="op">=</span> <span class="va">n_iterations</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type<span class="op">=</span><span class="st">"U"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Probability an animal is tested in origin</span></span>
<span><span class="va">test_origin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type<span class="op">=</span><span class="st">"0"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># EXPRESSIONS</span></span>
<span><span class="co"># Probability that an animal in an infected herd is infected (a = animal)</span></span>
<span><span class="va">inf</span> <span class="op">&lt;-</span> <span class="va">w_prev</span></span>
<span><span class="co"># Probability an animal is tested and is a false negative </span></span>
<span><span class="co"># (test specificity assumed to be 100%)</span></span>
<span><span class="va">false_neg</span> <span class="op">&lt;-</span> <span class="va">inf</span> <span class="op">*</span> <span class="va">test_origin</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_sensi</span><span class="op">)</span></span>
<span><span class="co"># Probability an animal is not tested</span></span>
<span><span class="va">no_test</span> <span class="op">&lt;-</span> <span class="va">inf</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_origin</span><span class="op">)</span></span>
<span><span class="co"># Probability an animal is not detected</span></span>
<span><span class="va">no_detect</span> <span class="op">&lt;-</span> <span class="va">false_neg</span> <span class="op">+</span> <span class="va">no_test</span></span>
<span></span>
<span><span class="va">mc_model</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mc.html" class="external-link">mc</a></span><span class="op">(</span><span class="va">w_prev</span>, <span class="va">inf</span>, <span class="va">test_origin</span>, <span class="va">test_sensi</span>, </span>
<span>             <span class="va">false_neg</span>, <span class="va">no_test</span>, <span class="va">no_detect</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># RESULT</span></span>
<span><span class="va">no_detect</span></span></code></pre></div>
<pre><code><span><span class="co">##   node    mode nsv   nsu nva variate    min   mean median    max Nas type outm</span></span>
<span><span class="co">## 1    x numeric   1 10000   2       1 0.0139 0.0175 0.0174 0.0217   0    U each</span></span>
<span><span class="co">## 2    x numeric   1 10000   2       2 0.0477 0.0787 0.0783 0.1178   0    U each</span></span></code></pre>
<p>Instead of manually typing the parameter values, you can also use
columns from a data table in <code><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata()</a></code>. A useful template
for setting up risk analysis models using <code>mc2d</code>, with custom
functions to facilitate data manipulation and visualization, can be
found in this repository: <a href="https://github.com/NataliaCiria/risk_analysis_template" class="external-link uri">https://github.com/NataliaCiria/risk_analysis_template</a>.</p>
</div>
<div class="section level3">
<h3 id="when-to-use-mcmodule">When to use mcmodule?<a class="anchor" aria-label="anchor" href="#when-to-use-mcmodule"></a>
</h3>
<p>The <code>mc2d</code> multivariate approach works well for basic
multivariate risk analysis. However, if instead of purchasing one cow,
you’re dealing with multiple cattle purchases, from different farms,
across different pathogens, scenarios, and age categories, or modeling
multiple risk pathways with different what-if scenarios, this approach
becomes unwieldy.</p>
<p><code>mcmodule</code> addresses these challenges by providing
functions for <strong>multivariate operations</strong> and
<strong>modular management</strong> of the risk model. It automates the
process of creating mcnodes and assigns metadata to them (making it easy
to identify which variate corresponds to which data row). Thanks to this
mcnode metadata, it enables row-matching between nodes with different
variates, combines probabilities across variates, and calculates
multilevel trials. As your risk analysis grows, you can create separate
modules for different pathways, each with independent parameters,
expressions, and scenarios that can later be connected into a complete
model.</p>
<p>This package is particularly useful for:</p>
<ul>
<li><p><strong>Working with complex models</strong> that involve
multiple pathways, pathogens, or scenarios simultaneously</p></li>
<li><p><strong>Dealing with large parameter sets</strong> (hundreds or
thousands of parameters)</p></li>
<li><p><strong>Handling different numbers of variates</strong> across
different parts of your model that need to be combined</p></li>
<li><p><strong>Creating modular risk assessments</strong> where
different components need to be developed independently but later
integrated (for example in collaborative projects)</p></li>
<li><p><strong>Performing sophisticated sensitivity analyses</strong>
across multiple model components</p></li>
</ul>
<p>However, for simpler analyses, such as single pathway models,
exploratory work, small models with few parameters, one-off analyses or
learning risk assessment <code>mcmodule</code>’s additional structure
may be unnecessary.</p>
</div>
</div>
<div class="section level2">
<h2 id="installing-mcmodule">Installing mcmodule<a class="anchor" aria-label="anchor" href="#installing-mcmodule"></a>
</h2>
<p>Now let’s explore this new package! It’s about to be submitted to
CRAN, but since it’s not there yet, we’ll install it from GitHub
instead.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"NataliaCiria/mcmodule"</span><span class="op">)</span></span></code></pre></div>
<p>And we load the package in our R session. Easy-peasy, ready to
go!</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/NataliaCiria/mcmodule" class="external-link">mcmodule</a></span><span class="op">)</span></span></code></pre></div>
<p>Other recommended packages to load along with mcmodule are:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>     <span class="co"># Data manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>     <span class="co"># Data cleaning</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>   <span class="co"># Plots</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span>    <span class="co"># Network analysis</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://datastorm-open.github.io/visNetwork/" class="external-link">visNetwork</a></span><span class="op">)</span><span class="co"># Interactive network visualization</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="building-an-mcmodule">Building an mcmodule<a class="anchor" aria-label="anchor" href="#building-an-mcmodule"></a>
</h2>
<p>To quickly understand the key components of an mcmodule, we’ll start
by building one using the animal imports example included in the
package. For a more detailed view of each component, refer to the <a href="https://nataliaciria.github.io/mcmodule/articles/mcmodule.html#model-elements">model
elements</a> section in the package vignette.</p>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>Let’s consider a scenario where we want to evaluate the risk of
introducing pathogen A and pathogen B into our region from animal
imports from different regions (north, south, east, and west). We have
gathered the following data:</p>
<ul>
<li>
<p><code>animal_imports</code>: number of animal imports with their
mean and standard deviation values per region, and the number of
exporting farms in each region.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">animal_imports</span></span></code></pre></div>
<pre><code><span><span class="co">##   origin farms_n animals_n_mean animals_n_sd</span></span>
<span><span class="co">## 1   nord       5            100            6</span></span>
<span><span class="co">## 2  south      10            130           10</span></span>
<span><span class="co">## 3   east       7            140           12</span></span></code></pre>
</li>
<li>
<p><code>prevalence_region</code>: estimates for both herd and
within-herd prevalence ranges for pathogens A and B, as well as an
indicator of how often tests are performed in origin</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prevalence_region</span></span></code></pre></div>
<pre><code><span><span class="co">##   pathogen origin h_prev_min h_prev_max w_prev_min w_prev_max test_origin</span></span>
<span><span class="co">## 1        a   nord       0.08       0.10       0.15        0.2   sometimes</span></span>
<span><span class="co">## 2        a  south       0.02       0.05       0.15        0.2   sometimes</span></span>
<span><span class="co">## 3        a   east       0.10       0.15       0.15        0.2       never</span></span>
<span><span class="co">## 4        b   nord       0.50       0.70       0.45        0.6      always</span></span>
<span><span class="co">## 5        b  south       0.25       0.30       0.37        0.4   sometimes</span></span>
<span><span class="co">## 6        b   east       0.30       0.50       0.45        0.6     unknown</span></span></code></pre>
</li>
<li>
<p><code>test_sensitivity</code>: estimates of test sensitivity
values for pathogen A and B</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_sensitivity</span></span></code></pre></div>
<pre><code><span><span class="co">##   pathogen test_sensi_min test_sensi_mode test_sensi_max</span></span>
<span><span class="co">## 1        a           0.89            0.90           0.91</span></span>
<span><span class="co">## 2        b           0.80            0.85           0.90</span></span></code></pre>
</li>
</ul>
<p>Now we will use <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">dplyr::left_join()</a></code> to create our imports
module data:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports_data</span><span class="op">&lt;-</span><span class="va">prevalence_region</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">animal_imports</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">test_sensitivity</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">pathogen</span>, <span class="va">origin</span>, <span class="va">test_origin</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(origin)`</span></span>
<span><span class="co">## Joining with `by = join_by(pathogen)`</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="data-keys">Data keys<a class="anchor" aria-label="anchor" href="#data-keys"></a>
</h3>
<p>From now on we will use only the merged <code>imports_data</code>
table. However, it is useful to understand which input dataset each
parameter comes from, as each dataset provides information for different
keys. In this context, keys are fields that (combined) uniquely identify
each row in a table. In our example:</p>
<ul>
<li><p><code>animal_imports</code> provided information by region of
<code>"origin"</code></p></li>
<li><p><code>prevalence_region</code> provided information by
<code>"pathogen"</code> and region of <code>"origin"</code></p></li>
<li><p><code>test_sensitivity</code> provided information by
<code>"pathogen"</code> only</p></li>
</ul>
<p>The resulting merged table, <code>imports_data</code>, will therefore
have two keys: <code>"pathogen"</code> and <code>"origin"</code>.
However, not all parameters will use both keys, for example,
<code>"test_sensi"</code> only has information by
<code>"pathogen"</code>. Knowing the keys for each parameter is crucial
when performing multivariate operations, such as <a href="https://nataliaciria.github.io/mcmodule/articles/intro.html#calculating-totals">calculating
totals</a>.</p>
<p>To make these relationships explicit in the model, we need to provide
the data keys. These are defined in a list with one element for each
input dataset, specifying both the columns and the keys for each
dataset.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports_data_keys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  animal_imports <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">animal_imports</span><span class="op">)</span>,</span>
<span>    keys <span class="op">=</span> <span class="st">"origin"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  prevalence_region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">prevalence_region</span><span class="op">)</span>,</span>
<span>    keys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pathogen"</span>, <span class="st">"origin"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  test_sensitivity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">test_sensitivity</span><span class="op">)</span>,</span>
<span>    keys <span class="op">=</span> <span class="st">"pathogen"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="mcnodes-table">mcnodes table<a class="anchor" aria-label="anchor" href="#mcnodes-table"></a>
</h3>
<p>With values and keys established, we still need some information to
build our stochastic parameters. The mcnode table specifies how to build
mcnodes from the data table. It specifies which parameters are included
in the model, the type of parameters (those with an mc_func are
stochastic), and what columns to look for in the data table to build
this mcnodes (the name of the mcnode, or another variable in the data
columns), as well as transformations that are usefull to encode
categorical data values into mcnodes that must always be numeric.</p>
<ul>
<li><p>mcnode: Name of the Monte Carlo node (required)</p></li>
<li><p>description: Description of the parameter</p></li>
<li><p>mc_func: Probability distribution</p></li>
<li><p>from_variable: Column name, if it comes from a column with a name
different to the mcnode</p></li>
<li><p>transformation: Transformation to be applied to the original
column values</p></li>
<li><p>sensi_analysis: Whether to include in sensitivity
analysis</p></li>
</ul>
<p>Here we have the <code>imports_mctable</code> for our example. While
the mctable can be hard-coded in R, it’s more efficient to prepare it in
a CSV or other external file. This approach also allows the table to be
included as part of the model documentation.</p>
<table class="table">
<colgroup>
<col width="7%">
<col width="33%">
<col width="3%">
<col width="6%">
<col width="43%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">mcnode</th>
<th align="left">description</th>
<th align="left">mc_func</th>
<th align="left">from_variable</th>
<th align="left">transformation</th>
<th align="left">sensi_analysis</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">h_prev</td>
<td align="left">Herd prevalence</td>
<td align="left">runif</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">w_prev</td>
<td align="left">Within herd prevalence</td>
<td align="left">runif</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">test_sensi</td>
<td align="left">Test sensitivity</td>
<td align="left">rpert</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">farms_n</td>
<td align="left">Number of farms exporting animals</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">animals_n</td>
<td align="left">Number of animals exported per farm</td>
<td align="left">rnorm</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">test_origin_unk</td>
<td align="left">Unknown probability of the animals being tested in
origin (true = unknown)</td>
<td align="left">NA</td>
<td align="left">test_origin</td>
<td align="left">value==“unknown”</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">test_origin</td>
<td align="left">Probability of the animals being tested in origin</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">ifelse(value == “always”, 1, ifelse(value ==
“sometimes”, 0.5, ifelse(value == “never”, 0, NA)))</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>The data table and the mctable must complement each other:</p>
<ul>
<li><p>mcnodes without a <code>mc_func</code> (like
<code>farms_n</code>), needs the matching column name
(<code>"farms_n"</code>) in the data table</p></li>
<li>
<p>mcnodes with an <code>mc_func</code>, you need <strong>columns
for each probability distribution argument in the</strong> <strong>data
table</strong>. For example:</p>
<ul>
<li><p><code>h_prev</code> with <code>runif</code> distribution requires
<code>"h_prev_min"</code> and <code>"h_prev_max"</code></p></li>
<li><p><code>animals_n</code> with <code>rnorm</code> distribution
requires <code>"animals_n_mean"</code> and
<code>"animals_n_sd"</code></p></li>
</ul>
</li>
</ul>
<p>For encoding categorical variables as mcnodes (or any other data
transformation), you can use any R code with <code>value</code> as a
placeholder for the mcnode name or column name (specified in
<code>from_variable</code>)</p>
</div>
<div class="section level3">
<h3 id="expressions">Expressions<a class="anchor" aria-label="anchor" href="#expressions"></a>
</h3>
<p>Finally, we need to write the model’s mathematical expression. This
expressions should ideally include only arithmetic operations, not R
functions (with some exceptions that will be covered later in “<a href="https://nataliaciria.github.io/mcmodule/articles/intro.html#tricks-and-tweaks">tricks
and tweaks</a>”). We’ll wrap them using <code><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote()</a></code> so they
aren’t executed immediately but stored for later evaluation with
<code>eval_model()</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports_exp</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="co"># Probability that an animal in an infected herd is infected (a = animal)</span></span>
<span>  <span class="va">inf</span> <span class="op">&lt;-</span> <span class="va">w_prev</span></span>
<span>  <span class="co"># Probability an animal is tested and is a false negative </span></span>
<span>  <span class="co"># (test specificity assumed to be 100%)</span></span>
<span>  <span class="va">false_neg</span> <span class="op">&lt;-</span> <span class="va">inf</span> <span class="op">*</span> <span class="va">test_origin</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_sensi</span><span class="op">)</span></span>
<span>  <span class="co"># Probability an animal is not tested</span></span>
<span>  <span class="va">no_test</span> <span class="op">&lt;-</span> <span class="va">inf</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_origin</span><span class="op">)</span></span>
<span>  <span class="co"># Probability an animal is not detected</span></span>
<span>  <span class="va">no_detect</span> <span class="op">&lt;-</span> <span class="va">false_neg</span> <span class="op">+</span> <span class="va">no_test</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="evaluating-a-model">Evaluating a model<a class="anchor" aria-label="anchor" href="#evaluating-a-model"></a>
</h3>
<p>With all components in place, we’re now ready to create our first
mcmodule using <code><a href="../reference/eval_module.html">eval_module()</a></code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/eval_module.html">eval_module</a></span><span class="op">(</span></span>
<span>  exp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>imports<span class="op">=</span><span class="va">imports_exp</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">imports_data</span>,</span>
<span>  mctable <span class="op">=</span> <span class="va">imports_mctable</span>,</span>
<span>  data_keys <span class="op">=</span> <span class="va">imports_data_keys</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## imports evaluated</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## mcmodule created (expressions: imports)</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">imports</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "mcmodule"</span></span></code></pre>
<p>An mcmodule is an S3 object class, and it is essentially a list that
contains all risk assessment components in a structured format.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">imports</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "data"      "exp"       "node_list" "modules"</span></span></code></pre>
<p>The mcmodule contains the input <code>data</code> and mathematical
expressions (<code>exp</code>) that ensure traceability. All input and
calculated parameters are stored in <code>node_list</code>. Each node
contains not only the mcnode itself but also important metadata: node
type (input or output), source dataset and columns, keys, calculation
method, and more. The specific metadata varies depending on the node’s
characteristics. Here are a few examples:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports</span><span class="op">$</span><span class="va">node_list</span><span class="op">$</span><span class="va">w_prev</span></span></code></pre></div>
<pre><code><span><span class="co">## $type</span></span>
<span><span class="co">## [1] "in_node"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $mc_func</span></span>
<span><span class="co">## [1] "runif"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $description</span></span>
<span><span class="co">## [1] "Within herd prevalence"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $inputs_col</span></span>
<span><span class="co">## [1] "w_prev_min" "w_prev_max"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $input_dataset</span></span>
<span><span class="co">## [1] "prevalence_region"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $keys</span></span>
<span><span class="co">## [1] "pathogen" "origin"  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $module</span></span>
<span><span class="co">## [1] "imports"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $mc_name</span></span>
<span><span class="co">## [1] "w_prev"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $mcnode</span></span>
<span><span class="co">##   node    mode  nsv nsu nva variate  min  mean median max Nas type outm</span></span>
<span><span class="co">## 1    x numeric 1001   1   6       1 0.15 0.175  0.175 0.2   0    V each</span></span>
<span><span class="co">## 2    x numeric 1001   1   6       2 0.15 0.175  0.174 0.2   0    V each</span></span>
<span><span class="co">## 3    x numeric 1001   1   6       3 0.15 0.175  0.174 0.2   0    V each</span></span>
<span><span class="co">## 4    x numeric 1001   1   6       4 0.45 0.524  0.525 0.6   0    V each</span></span>
<span><span class="co">## 5    x numeric 1001   1   6       5 0.37 0.385  0.386 0.4   0    V each</span></span>
<span><span class="co">## 6    x numeric 1001   1   6       6 0.45 0.523  0.524 0.6   0    V each</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $data_name</span></span>
<span><span class="co">## [1] "imports_data"</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports</span><span class="op">$</span><span class="va">node_list</span><span class="op">$</span><span class="va">no_detect</span></span></code></pre></div>
<pre><code><span><span class="co">## $node_exp</span></span>
<span><span class="co">## [1] "false_neg + no_test"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $type</span></span>
<span><span class="co">## [1] "out_node"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $inputs</span></span>
<span><span class="co">## [1] "false_neg" "no_test"  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $module</span></span>
<span><span class="co">## [1] "imports"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $mc_name</span></span>
<span><span class="co">## [1] "no_detect"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $keys</span></span>
<span><span class="co">## [1] "pathogen" "origin"  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $param</span></span>
<span><span class="co">## [1] "false_neg" "no_test"  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $mcnode</span></span>
<span><span class="co">##   node    mode  nsv nsu nva variate    min   mean median   max Nas type outm</span></span>
<span><span class="co">## 1    x numeric 1001   1   6       1 0.0822 0.0961 0.0960 0.110   0    V each</span></span>
<span><span class="co">## 2    x numeric 1001   1   6       2 0.0824 0.0960 0.0959 0.110   0    V each</span></span>
<span><span class="co">## 3    x numeric 1001   1   6       3 0.1500 0.1746 0.1742 0.200   0    V each</span></span>
<span><span class="co">## 4    x numeric 1001   1   6       4 0.0500 0.0787 0.0781 0.110   0    V each</span></span>
<span><span class="co">## 5    x numeric 1001   1   6       5 0.2059 0.2214 0.2214 0.237   0    V each</span></span>
<span><span class="co">## 6    x numeric 1001   1   6       6 0.4504 0.5233 0.5241 0.600   0    V each</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $data_name</span></span>
<span><span class="co">## [1] "imports_data"</span></span></code></pre>
<p>And now that we have an mcmodule, we can begin exploring its
possibilities!</p>
</div>
</div>
<div class="section level2">
<h2 id="sec-calculating-totals">Summarizing<a class="anchor" aria-label="anchor" href="#sec-calculating-totals"></a>
</h2>
<p>In the imports mcmodule, we can already see the raw mcnode results
for the probability of an imported animal not being detected
(<code>no_detect</code>). However, it’s difficult to determine which
pathogen or region these results refer to. The <code><a href="../reference/mc_summary.html">mc_summary()</a></code>
function solves this problem by linking mcnode results with their key
columns in the data.</p>
<blockquote>
<p>Note that while the printed summary looks similar to the raw mcnode,
it’s actually just a dataframe containing statistical measures, whereas
the actual mcnode is a large array of numbers with dimensions
(uncertainty × 1 × variates),</p>
</blockquote>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mc_summary.html">mc_summary</a></span><span class="op">(</span>mcmodule <span class="op">=</span> <span class="va">imports</span>, mc_name <span class="op">=</span> <span class="st">"no_detect"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     mc_name pathogen origin       mean          sd        Min       2.5%</span></span>
<span><span class="co">## 1 no_detect        a   nord 0.09607419 0.007983987 0.08215801 0.08318831</span></span>
<span><span class="co">## 2 no_detect        a  south 0.09600944 0.007877740 0.08241757 0.08325282</span></span>
<span><span class="co">## 3 no_detect        a   east 0.17458727 0.014431815 0.15001204 0.15091040</span></span>
<span><span class="co">## 4 no_detect        b   nord 0.07870798 0.011697425 0.05000413 0.05776186</span></span>
<span><span class="co">## 5 no_detect        b  south 0.22143628 0.006212484 0.20587390 0.21013928</span></span>
<span><span class="co">## 6 no_detect        b   east 0.52329144 0.043320684 0.45044560 0.45356043</span></span>
<span><span class="co">##          25%        50%        75%     97.5%       Max  nsv Na's</span></span>
<span><span class="co">## 1 0.08903559 0.09597030 0.10302211 0.1094443 0.1104595 1001    0</span></span>
<span><span class="co">## 2 0.08913769 0.09594299 0.10261766 0.1093425 0.1104777 1001    0</span></span>
<span><span class="co">## 3 0.16228149 0.17419132 0.18660810 0.1992568 0.1999452 1001    0</span></span>
<span><span class="co">## 4 0.07012427 0.07811934 0.08762139 0.1022697 0.1100034 1001    0</span></span>
<span><span class="co">## 5 0.21712775 0.22136949 0.22595050 0.2331940 0.2373635 1001    0</span></span>
<span><span class="co">## 6 0.48400210 0.52407730 0.55987018 0.5956471 0.5998064 1001    0</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="calculating-totals">Calculating totals<a class="anchor" aria-label="anchor" href="#calculating-totals"></a>
</h2>
<p>In <code>imports</code>, we have the probability that an infected
animal from an infected farm goes undetected (<code>"no_detect"</code>).
When all animals (in a variate) have the same probability, we can use
the total number of animals selected per farm (<code>"animals_n"</code>)
as the number of trials (<code>trials_n</code>) to determine the
probability that at least one infected animal from one farm is not
detected (no_detect_set).</p>
<blockquote>
<p>Note that while <code>"animals_n"</code> is not found as an mcnode in
<code>imports</code> (it was not used in <code>imports$exp</code>), it
can be automatically generated in <code><a href="../reference/trial_totals.html">trial_totals()</a></code> because
it’s included in <code>imports_mctable</code> and the required data
exists in <code>imports$data</code>.</p>
</blockquote>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Probability of at least one imported animal from an infected herd is not detected </span></span>
<span><span class="va">imports</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trial_totals.html">trial_totals</a></span><span class="op">(</span></span>
<span>  mcmodule <span class="op">=</span> <span class="va">imports</span>,</span>
<span>  mc_names <span class="op">=</span> <span class="st">"no_detect"</span>,</span>
<span>  trials_n <span class="op">=</span> <span class="st">"animals_n"</span>,</span>
<span>  mctable <span class="op">=</span> <span class="va">imports_mctable</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note that this function returns an mcmodule with some additional
nodes. Total nodes have special metadata fields, and always include a
summary by default.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports</span><span class="op">$</span><span class="va">node_list</span><span class="op">$</span><span class="va">no_detect_set</span><span class="op">$</span><span class="va">summary</span></span></code></pre></div>
<pre><code><span><span class="co">##         mc_name pathogen origin      mean           sd       Min      2.5%</span></span>
<span><span class="co">## 1 no_detect_set        a   nord 0.9999297 7.727405e-05 0.9994212 0.9997105</span></span>
<span><span class="co">## 2 no_detect_set        a  south 0.9999946 1.050803e-05 0.9998086 0.9999702</span></span>
<span><span class="co">## 3 no_detect_set        a   east 1.0000000 1.660241e-09 1.0000000 1.0000000</span></span>
<span><span class="co">## 4 no_detect_set        b   nord 0.9993751 8.936518e-04 0.9922377 0.9966265</span></span>
<span><span class="co">## 5 no_detect_set        b  south 1.0000000 1.150669e-12 1.0000000 1.0000000</span></span>
<span><span class="co">## 6 no_detect_set        b   east 1.0000000 0.000000e+00 1.0000000 1.0000000</span></span>
<span><span class="co">##         25%       50%       75%     97.5%       Max  nsv Na's</span></span>
<span><span class="co">## 1 0.9999072 0.9999566 0.9999812 0.9999955 0.9999984 1001    0</span></span>
<span><span class="co">## 2 0.9999941 0.9999978 0.9999993 0.9999999 1.0000000 1001    0</span></span>
<span><span class="co">## 3 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1001    0</span></span>
<span><span class="co">## 4 0.9992492 0.9997117 0.9998958 0.9999839 0.9999970 1001    0</span></span>
<span><span class="co">## 5 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1001    0</span></span>
<span><span class="co">## 6 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1001    0</span></span></code></pre>
<div class="section level3">
<h3 id="multilevel-trials">Multilevel trials<a class="anchor" aria-label="anchor" href="#multilevel-trials"></a>
</h3>
<div class="section level4">
<h4 id="simple-multilevel">Simple multilevel<a class="anchor" aria-label="anchor" href="#simple-multilevel"></a>
</h4>
<p>When considering animals (trials_n) from different farms (subset_n),
we must account for both the farm’s probability of being infected
(subset_p) and the individual animal’s probability of being infected
(trial_p).</p>
<p><img src="images/mcmodule_multilevel_trial_drawing.png"></p>
<p><img src="images/mcmodule_multilevel_trial_diagram.png"></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Probability of at least one animal from at least one herd being is not detected (probability of a herd being infected: h_prev)</span></span>
<span><span class="va">imports_mcmodule</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trial_totals.html">trial_totals</a></span><span class="op">(</span></span>
<span>  mcmodule <span class="op">=</span> <span class="va">imports</span>,</span>
<span>  mc_names <span class="op">=</span> <span class="st">"no_detect"</span>,</span>
<span>  trials_n <span class="op">=</span> <span class="st">"animals_n"</span>,</span>
<span>  subsets_n <span class="op">=</span> <span class="st">"farms_n"</span>,</span>
<span>  subsets_p <span class="op">=</span> <span class="st">"h_prev"</span>,</span>
<span>  mctable <span class="op">=</span> <span class="va">imports_mctable</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Result</span></span>
<span><span class="va">imports</span><span class="op">$</span><span class="va">node_list</span><span class="op">$</span><span class="va">no_detect_set</span></span></code></pre></div>
<pre><code><span><span class="co">## $mcnode</span></span>
<span><span class="co">##   node    mode  nsv nsu nva variate   min  mean median max Nas type outm</span></span>
<span><span class="co">## 1    x numeric 1001   1   6       1 0.999 1.000      1   1   0    V each</span></span>
<span><span class="co">## 2    x numeric 1001   1   6       2 1.000 1.000      1   1   0    V each</span></span>
<span><span class="co">## 3    x numeric 1001   1   6       3 1.000 1.000      1   1   0    V each</span></span>
<span><span class="co">## 4    x numeric 1001   1   6       4 0.992 0.999      1   1   0    V each</span></span>
<span><span class="co">## 5    x numeric 1001   1   6       5 1.000 1.000      1   1   0    V each</span></span>
<span><span class="co">## 6    x numeric 1001   1   6       6 1.000 1.000      1   1   0    V each</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $param</span></span>
<span><span class="co">## [1] "no_detect" "animals_n" "1"         "1"        </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $inputs</span></span>
<span><span class="co">## [1] "no_detect" "animals_n" "1"         "1"        </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $description</span></span>
<span><span class="co">## [1] "Probability of at least one no_detect in a set (set)"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $node_expression</span></span>
<span><span class="co">## [1] "1-(1-1*(1-(1-no_detect)^animals_n))^1"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $type</span></span>
<span><span class="co">## [1] "total"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $module</span></span>
<span><span class="co">## [1] "imports"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $keys</span></span>
<span><span class="co">## [1] "pathogen" "origin"  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $scenario</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $data_name</span></span>
<span><span class="co">## [1] "imports_data"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $prefix</span></span>
<span><span class="co">## [1] ""</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $total_type</span></span>
<span><span class="co">## [1] "single level set prob"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $summary</span></span>
<span><span class="co">##         mc_name pathogen origin      mean           sd       Min      2.5%</span></span>
<span><span class="co">## 1 no_detect_set        a   nord 0.9999297 7.727405e-05 0.9994212 0.9997105</span></span>
<span><span class="co">## 2 no_detect_set        a  south 0.9999946 1.050803e-05 0.9998086 0.9999702</span></span>
<span><span class="co">## 3 no_detect_set        a   east 1.0000000 1.660241e-09 1.0000000 1.0000000</span></span>
<span><span class="co">## 4 no_detect_set        b   nord 0.9993751 8.936518e-04 0.9922377 0.9966265</span></span>
<span><span class="co">## 5 no_detect_set        b  south 1.0000000 1.150669e-12 1.0000000 1.0000000</span></span>
<span><span class="co">## 6 no_detect_set        b   east 1.0000000 0.000000e+00 1.0000000 1.0000000</span></span>
<span><span class="co">##         25%       50%       75%     97.5%       Max  nsv Na's</span></span>
<span><span class="co">## 1 0.9999072 0.9999566 0.9999812 0.9999955 0.9999984 1001    0</span></span>
<span><span class="co">## 2 0.9999941 0.9999978 0.9999993 0.9999999 1.0000000 1001    0</span></span>
<span><span class="co">## 3 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1001    0</span></span>
<span><span class="co">## 4 0.9992492 0.9997117 0.9998958 0.9999839 0.9999970 1001    0</span></span>
<span><span class="co">## 5 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1001    0</span></span>
<span><span class="co">## 6 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1001    0</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="combining-mcmodules">Combining mcmodules<a class="anchor" aria-label="anchor" href="#combining-mcmodules"></a>
</h2>
<p>…</p>
</div>
<div class="section level2">
<h2 id="visualizing-mcmodule-models">Visualizing mcmodule models<a class="anchor" aria-label="anchor" href="#visualizing-mcmodule-models"></a>
</h2>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mc_network.html">mc_network</a></span><span class="op">(</span><span class="va">imports</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:432.632880098888px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"nodes":{"id":["w_prev","test_origin","test_sensi","inf","false_neg","no_test","no_detect","animals_n","no_detect_set","no_detect_set_n","w_prev_min","w_prev_max","imports_data","prevalence_region","test_sensi_min","test_sensi_mode","test_sensi_max","test_sensitivity","animals_n_mean","animals_n_sd"],"color":["#BDCCDB","#BDCCDB","#BDCCDB","#18BC9C","#18BC9C","#18BC9C","#18BC9C","#F9CF8B","#F39C12","#F39C12","#89A3BE","#89A3BE",null,null,"#89A3BE","#89A3BE","#89A3BE",null,"#89A3BE","#89A3BE"],"module":["imports","imports","imports","imports","imports","imports","imports","imports","imports","imports","inputs_col","inputs_col","input_data","input_dataset","inputs_col","inputs_col","inputs_col","input_dataset","inputs_col","inputs_col"],"expression":["runif","runif","runif","w_prev","inf * test_origin * (1 - test_sensi)","inf * (1 - test_origin)","false_neg + no_test",null,null,null,null,null,null,null,null,null,null,null,null,null],"title":["<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>w_prev<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>17.45% (15.13%-19.89%)<br><\/strong>runif<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">w_prev_min<br> w_prev_max<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>test_origin<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.5<br><\/strong>runif<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">test_origin<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>test_sensi<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>90.02% (89.31%-90.71%)<br><\/strong>runif<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">test_sensi_min<br> test_sensi_mode<br> test_sensi_max<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>inf<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>17.45% (15.13%-19.89%)<br><\/strong>w_prev<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">w_prev<\/td>\n          <td style=\"width: 50%; text-align: center;\">w_prev<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>false_neg<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.87% (0.73%-1.02%)<br><\/strong>inf * test_origin * (1 - test_sensi)<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">test_origin<br> test_sensi<\/td>\n          <td style=\"width: 50%; text-align: center;\">test_origin<br> test_sensi<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_test<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>8.73% (7.56%-9.94%)<br><\/strong>inf * (1 - test_origin)<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">test_origin<\/td>\n          <td style=\"width: 50%; text-align: center;\">test_origin<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>9.6% (8.32%-10.94%)<br><\/strong>false_neg + no_test<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">false_neg<br> no_test<\/td>\n          <td style=\"width: 50%; text-align: center;\">false_neg<br> no_test<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>animals_n<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>99.9 (87.44-111.55)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">animals_n_mean<br> animals_n_sd<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect_set<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>100% (99.97%-100%)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> 1<br> 1<\/td>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> 1<br> 1<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect_set_n<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>9.55 (7.78-11.66)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> 1<br> 1<\/td>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> 1<br> 1<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>w_prev_min<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">inputs_col<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.15<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">imports_data<br> prevalence_region<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>w_prev_max<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">inputs_col<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.2<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">imports_data<br> prevalence_region<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>imports_data<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">input_data<\/span><\/p>\n    <p style=\"text-align: center;\"><strong><br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\"><br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>prevalence_region<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">input_dataset<\/span><\/p>\n    <p style=\"text-align: center;\"><strong><br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\"><br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>test_sensi_min<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">inputs_col<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.89<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">imports_data<br> test_sensitivity<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>test_sensi_mode<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">inputs_col<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.9<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">imports_data<br> test_sensitivity<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>test_sensi_max<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">inputs_col<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.91<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">imports_data<br> test_sensitivity<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>test_sensitivity<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">input_dataset<\/span><\/p>\n    <p style=\"text-align: center;\"><strong><br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\"><br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>animals_n_mean<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">inputs_col<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>100<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">imports_data<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>animals_n_sd<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">inputs_col<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>6<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">imports_data<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>"],"label":["w_prev","test_origin","test_sensi","inf","false_neg","no_test","no_detect","animals_n","no_detect_set","no_detect_set_n","w_prev_min","w_prev_max","imports_data","prevalence_region","test_sensi_min","test_sensi_mode","test_sensi_max","test_sensitivity","animals_n_mean","animals_n_sd"],"x":[0.7333333333333334,0.4666666666666666,-0.2,0.7333333333333334,-0.06666666666666665,1,0.2,-0.8666666666666667,-0.8666666666666667,0.2,0.7333333333333334,1,-0.06666666666666665,-0.2,-0.4666666666666667,0.06666666666666665,-0.2,0.06666666666666665,-1,-0.7333333333333334],"y":[0,-0.3333333333333334,0,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.6666666666666667,0.6666666666666667,1,1,-0.3333333333333334,-0.3333333333333334,-0.6666666666666667,-1,-0.3333333333333334,-0.3333333333333334,-0.3333333333333334,-1,0.3333333333333333,0.3333333333333333]},"edges":{"from":["w_prev_min","w_prev_max","prevalence_region","imports_data","imports_data","test_origin","imports_data","test_sensi_min","test_sensi_mode","test_sensi_max","test_sensitivity","imports_data","imports_data","imports_data","w_prev","test_origin","test_sensi","test_origin","false_neg","no_test","animals_n_mean","animals_n_sd","imports_data","imports_data","no_detect","animals_n","no_detect","animals_n"],"to":["w_prev","w_prev","imports_data","w_prev_min","w_prev_max","test_origin","test_origin","test_sensi","test_sensi","test_sensi","imports_data","test_sensi_min","test_sensi_mode","test_sensi_max","inf","false_neg","false_neg","no_test","no_detect","no_detect","animals_n","animals_n","animals_n_mean","animals_n_sd","no_detect_set","no_detect_set","no_detect_set_n","no_detect_set_n"],"id":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,28,29]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"arrows":"to","smooth":false},"physics":{"enabled":false},"interaction":{"dragNodes":true,"zoomSpeed":1}},"groups":null,"width":"100%","height":null,"idselection":{"enabled":true,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":true,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false,"variable":"module","main":"Select by module","values":["imports","input_data","input_dataset","inputs_col"]},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":2,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":false,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level2">
<h2 id="analysing-mcmodule-models">Analysing mcmodule models<a class="anchor" aria-label="anchor" href="#analysing-mcmodule-models"></a>
</h2>
</div>
<div class="section level2">
<h2 id="sec-tricks-and-tweaks">Tricks and tweaks<a class="anchor" aria-label="anchor" href="#sec-tricks-and-tweaks"></a>
</h2>
<div class="section level3">
<h3 id="remove-mcnode-nas">Remove mcnode NAs<a class="anchor" aria-label="anchor" href="#remove-mcnode-nas"></a>
</h3>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_mcnode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcstoc.html" class="external-link">mcstoc</a></span><span class="op">(</span><span class="va">runif</span>,</span>
<span>               min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">0.2</span>, <span class="op">-</span><span class="cn">Inf</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"0"</span>, nvariates <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>               max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">0.3</span>, <span class="cn">Inf</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"0"</span>, nvariates <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>               nvariates <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in (function (n, min = 0, max = 1) : NAs produced</span></span></code></pre>
<pre><code><span><span class="co">## Warning in (function (n, min = 0, max = 1) : NAs produced</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Replace NA and Inf with 0</span></span>
<span><span class="va">clean_mcnode</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcnode_na_rm.html">mcnode_na_rm</a></span><span class="op">(</span><span class="va">sample_mcnode</span><span class="op">)</span></span></code></pre></div>
<p>Useful to include in expressions were there is a division with a
denominator can potentially be 0 and it will return <code>Inf</code> or
<code>NaN</code>, but we actually want that parameter to be 0.</p>
</div>
<div class="section level3">
<h3 id="include-functions-in-expressions">Include functions in expressions<a class="anchor" aria-label="anchor" href="#include-functions-in-expressions"></a>
</h3>
</div>
<div class="section level3">
<h3 id="some-functions-that-can-be-used-without-mcmodules">Some functions that can be used without mcmodules<a class="anchor" aria-label="anchor" href="#some-functions-that-can-be-used-without-mcmodules"></a>
</h3>
<p>mc_summary with data and mcmodule</p>
<p>create_mcnodes</p>
</div>
</div>
<div class="section level2">
<h2 id="recommended-workflow">Recommended workflow<a class="anchor" aria-label="anchor" href="#recommended-workflow"></a>
</h2>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-mc2d" class="csl-entry">
Pouillot, R., and M.-L. Delignette-Muller. 2010. <span>“Evaluating
Variability and Uncertainty in Microbial Quantitative Risk Assessment
Using Two r Packages”</span> 142: 330–40.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Natalia Ciria.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
