<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>mcmodule • mcmodule</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="mcmodule">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mcmodule</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/mcmodule.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/multivariate_operations.html">Multivariate operations</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NataliaCiria/mcmodule/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="mcmodule_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="mcmodule_files/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="mcmodule_files/vis-9.1.0/vis-network.min.js"></script><script src="mcmodule_files/visNetwork-binding-2.1.4/visNetwork.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>mcmodule</h1>
            <h3 data-toc-skip class="subtitle">Modular Monte-Carlo Risk
Analysis</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NataliaCiria/mcmodule/blob/main/vignettes/mcmodule.Rmd" class="external-link"><code>vignettes/mcmodule.Rmd</code></a></small>
      <div class="d-none name"><code>mcmodule.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>mcmodule</code> is a framework for building modular Monte Carlo
risk analysis models. It extends the capabilities of <code>mc2d</code>
to make working with multiple risk pathways, variates, and scenarios
easier. It was developed by epidemiologists, for the <a href="https://github.com/VetEpi-UAB/farmrisk" class="external-link">farmrisk</a> project, and
now it aims to help epidemiologists and other risk modellers save time
and evaluate ambitious, complex risk pathways in R.</p>
<p>The <code>mc2d</code> R package <span class="citation">(<a href="#ref-mc2d">Pouillot and Delignette-Muller 2010</a>)</span>
provides tools to build and analyse models involving multiple variables
and uncertainties based on Monte Carlo simulations. The
<code>mcmodule</code> package includes additional tools to:</p>
<ol style="list-style-type: decimal">
<li>Organize risk analysis in independent flexible modules</li>
<li>Perform multivariate mcnode operations</li>
<li>Automate the creation of mcnodes</li>
<li>Visualize risk analysis models</li>
</ol>
<div class="section level3">
<h3 id="multivariate-monte-carlo-simulations">Multivariate Monte-Carlo simulations<a class="anchor" aria-label="anchor" href="#multivariate-monte-carlo-simulations"></a>
</h3>
<p>Quantitative risk analysis is the numerical assessment of risk to
facilitate decision making in the face of uncertainty. Monte Carlo
simulation is a technique used to model and analyse uncertainty <span class="citation">(<a href="#ref-Vose2008">Vose 2008</a>)</span>.</p>
<p>In <code>mc2d</code>, parameters are stored as
<strong>mcnode</strong> class objects. These objects are arrays of
numbers that represent random variables and have three dimensions:
<strong>variability × uncertainty × variates</strong>. For more
information, see the <a href="https://CRAN.R-project.org/package=mc2d" class="external-link">mc2d</a> package
vignette.</p>
<p><img src="images/mcmodule_node_dimensions.png" fig-align="center"></p>
<p>In the <code>mcmodule</code> framework an mcnode is an array of
<strong>dimensions (<em>u</em> × 1 × <em>i</em>)</strong>:</p>
<ul>
<li><p>We combine <strong>variability</strong> and
<strong>uncertainty</strong> into one dimension<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;It would be technically possible to separate variability
and uncertainty in &lt;code&gt;mcmodule&lt;/code&gt;, but we have not included this
functionality yet because of the exponential increase in computational
and programming requirements&lt;/p&gt;"><sup>1</sup></a>
(<strong><em>u</em></strong>)</p></li>
<li><p>We use <strong>variates</strong> (representing different groups
or categories) in the other dimension
(<strong><em>i</em></strong>)</p></li>
<li><p>The variables that define and distinguish these variates are
called <strong>keys</strong> and are stored as metadata</p></li>
</ul>
<p>In this document we will use the term “uncertainty dimension” to
refer to the combined dimension of variability and uncertainty.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>If we are buying a number of cows and heifers from a specific region,
an mcnode for herd prevalence would have:</p>
<ul>
<li><p>Multiple variates (rows), defined by two keys: “animal category”
and “pathogen”</p></li>
<li><p>Probability values generated through a PERT distribution, using
minimum, mode, and maximum parameters across <em>u</em> iterations
(columns) to model the uncertainty in these estimates</p></li>
</ul>
<div class="float">
<img src="images/mcmodule_mcnode_example.png" style="display: block; margin: 1em auto;width:85.0%" fig-align="center" alt="An mcnode representing herd prevalence of three pathogens, tuberculosis (TB), infectious bovine rhinotracheitis (IBR), and bovine viral diarrhoea (BVD), and two animal categories (cows and heifers). The herd prevalence is the same for both animal categories, but values differ due to the stochastic nature of random sampling from the PERT distribution."><div class="figcaption"><em>An mcnode representing herd prevalence of
three pathogens, tuberculosis (TB), infectious bovine rhinotracheitis
(IBR), and bovine viral diarrhoea (BVD), and two animal categories (cows
and heifers). The herd prevalence is the same for both animal
categories, but values differ due to the stochastic nature of random
sampling from the PERT distribution.</em></div>
</div>
</blockquote>
</div>
<div class="section level3">
<h3 id="risk-assessment">Risk assessment<a class="anchor" aria-label="anchor" href="#risk-assessment"></a>
</h3>
<p>This section provides a brief introduction to risk assessment in R.
Although this package is not intended for beginners in risk assessment,
it can help you understand the logic behind <code>mcmodule</code> and
its purpose.</p>
<div class="section level4">
<h4 id="a-simple-risk-assessment">A simple risk assessment<a class="anchor" aria-label="anchor" href="#a-simple-risk-assessment"></a>
</h4>
<p>Consider a scenario where we need to purchase a cow from a farm that
we know is infected with a disease our farm is free from. To reduce the
risk of introducing the disease to our farm, we plan to perform a
diagnostic test on the cow before bringing it to our farm. We want to
calculate the probability of introducing the disease by purchasing one
cow that tests negative.</p>
<p>We have an estimation (with some uncertainty) of both the probability
of animal infection within a herd and the test sensitivity, so we want
to conduct a <strong>stochastic</strong> risk assessment that properly
accounts for this <strong>uncertainty</strong>.</p>
<p>The risk assessment for our cattle purchase can be performed using
base R <span class="citation">(<a href="#ref-base">2024</a>)</span>
random sampling functions, or <code>mc2d</code> <span class="citation">(<a href="#ref-mc2d">Pouillot and Delignette-Muller
2010</a>)</span>, a package provides additional probability
distributions (such as <code>rpert</code>) and other useful tools for
analysing stochastic (Monte-Carlo) simulations.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mc2d</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n_iterations</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span></span>
<span><span class="co"># Within-herd prevalence</span></span>
<span><span class="va">w_prev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcstoc.html" class="external-link">mcstoc</a></span><span class="op">(</span><span class="va">runif</span>,</span>
<span>  min <span class="op">=</span> <span class="fl">0.15</span>, max <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  nsu <span class="op">=</span> <span class="va">n_iterations</span>, type <span class="op">=</span> <span class="st">"U"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Test sensitivity</span></span>
<span><span class="va">test_sensi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcstoc.html" class="external-link">mcstoc</a></span><span class="op">(</span><span class="va">rpert</span>,</span>
<span>  min <span class="op">=</span> <span class="fl">0.89</span>, mode <span class="op">=</span> <span class="fl">0.9</span>, max <span class="op">=</span> <span class="fl">0.91</span>,</span>
<span>  nsu <span class="op">=</span> <span class="va">n_iterations</span>, type <span class="op">=</span> <span class="st">"U"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Probability an animal is tested in origin</span></span>
<span><span class="va">test_origin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fl">1</span>, type <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span> <span class="co"># Yes</span></span>
<span></span>
<span></span>
<span><span class="co"># EXPRESSIONS</span></span>
<span><span class="co"># Probability that an animal in an infected herd is infected (a = animal)</span></span>
<span><span class="va">infected</span> <span class="op">&lt;-</span> <span class="va">w_prev</span></span>
<span><span class="co"># Probability an animal is tested and is a false negative</span></span>
<span><span class="co"># (test specificity assumed to be 100%)</span></span>
<span><span class="va">false_neg</span> <span class="op">&lt;-</span> <span class="va">infected</span> <span class="op">*</span> <span class="va">test_origin</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_sensi</span><span class="op">)</span></span>
<span><span class="co"># Probability an animal is not tested</span></span>
<span><span class="va">no_test</span> <span class="op">&lt;-</span> <span class="va">infected</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_origin</span><span class="op">)</span></span>
<span><span class="co"># Probability an animal is not detected</span></span>
<span><span class="va">no_detect</span> <span class="op">&lt;-</span> <span class="va">false_neg</span> <span class="op">+</span> <span class="va">no_test</span></span>
<span></span>
<span><span class="va">mc_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mc.html" class="external-link">mc</a></span><span class="op">(</span></span>
<span>  <span class="va">w_prev</span>, <span class="va">infected</span>, <span class="va">test_origin</span>, <span class="va">test_sensi</span>,</span>
<span>  <span class="va">false_neg</span>, <span class="va">no_test</span>, <span class="va">no_detect</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># RESULT</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">mc_model</span><span class="op">)</span></span></code></pre></div>
<p><img src="mcmodule_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">no_detect</span></span>
<span><span class="co">#&gt;   node    mode nsv   nsu nva variate    min   mean median    max Nas type outm</span></span>
<span><span class="co">#&gt; 1    x numeric   1 10000   1       1 0.0138 0.0175 0.0174 0.0218   0    U each</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="multiple-risk-assessments-at-once">Multiple risk assessments at once<a class="anchor" aria-label="anchor" href="#multiple-risk-assessments-at-once"></a>
</h4>
<p>In the previous example, we calculated the risk for one specific
case. However, we know that this farm is also positive for pathogen B,
so it would be also interesting to calculate the risk of introducing it
as well. Pathogen B has different within-herd prevalence and test
sensitivity than Pathogen A.</p>
<p>To estimate the risk for both pathogens with our previous models, we
could:</p>
<ul>
<li><p>Copy and paste the code twice with different parameters (against
all good coding practices)</p></li>
<li><p>Wrap the code in a function and call it twice using each
pathogen’s parameters as arguments</p></li>
<li><p>Create a loop</p></li>
</ul>
<p>While these options work, they become messy or computationally
intensive when the number of parameters or different situations to
simulate increases.</p>
<p>The package <code>mc2d</code> offers a clever solution to this
scalability problem: variates. In the previous example, our stochastic
nodes only had uncertainty dimension. However, we can now use the
<strong>variates</strong> dimension to calculate the risk of
introduction of both pathogens at the same time.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n_iterations</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span></span>
<span><span class="co"># Within-herd prevalence</span></span>
<span><span class="va">w_prev_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.15</span>, b <span class="op">=</span> <span class="fl">0.45</span><span class="op">)</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="va">w_prev_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.2</span>, b <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">w_prev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcstoc.html" class="external-link">mcstoc</a></span><span class="op">(</span><span class="va">runif</span>,</span>
<span>  min <span class="op">=</span> <span class="va">w_prev_min</span>, max <span class="op">=</span> <span class="va">w_prev_max</span>,</span>
<span>  nsu <span class="op">=</span> <span class="va">n_iterations</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"U"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test sensitivity</span></span>
<span><span class="va">test_sensi_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.89</span>, b <span class="op">=</span> <span class="fl">0.80</span><span class="op">)</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="va">test_sensi_mode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.9</span>, b <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="va">test_sensi_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.91</span>, b <span class="op">=</span> <span class="fl">0.90</span><span class="op">)</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_sensi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcstoc.html" class="external-link">mcstoc</a></span><span class="op">(</span><span class="va">rpert</span>,</span>
<span>  min <span class="op">=</span> <span class="va">test_sensi_min</span>,</span>
<span>  mode <span class="op">=</span> <span class="va">test_sensi_mode</span>, max <span class="op">=</span> <span class="va">test_sensi_max</span>,</span>
<span>  nsu <span class="op">=</span> <span class="va">n_iterations</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"U"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Probability an animal is tested in origin</span></span>
<span><span class="va">test_origin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, nvariates <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># EXPRESSIONS</span></span>
<span><span class="co"># Probability that an animal in an infected herd is infected (a = animal)</span></span>
<span><span class="va">infected</span> <span class="op">&lt;-</span> <span class="va">w_prev</span></span>
<span><span class="co"># Probability an animal is tested and is a false negative</span></span>
<span><span class="co"># (test specificity assumed to be 100%)</span></span>
<span><span class="va">false_neg</span> <span class="op">&lt;-</span> <span class="va">infected</span> <span class="op">*</span> <span class="va">test_origin</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_sensi</span><span class="op">)</span></span>
<span><span class="co"># Probability an animal is not tested</span></span>
<span><span class="va">no_test</span> <span class="op">&lt;-</span> <span class="va">infected</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_origin</span><span class="op">)</span></span>
<span><span class="co"># Probability an animal is not detected</span></span>
<span><span class="va">no_detect</span> <span class="op">&lt;-</span> <span class="va">false_neg</span> <span class="op">+</span> <span class="va">no_test</span></span>
<span></span>
<span><span class="va">mc_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mc.html" class="external-link">mc</a></span><span class="op">(</span></span>
<span>  <span class="va">w_prev</span>, <span class="va">infected</span>, <span class="va">test_origin</span>, <span class="va">test_sensi</span>,</span>
<span>  <span class="va">false_neg</span>, <span class="va">no_test</span>, <span class="va">no_detect</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># RESULT</span></span>
<span><span class="va">no_detect</span></span>
<span><span class="co">#&gt;   node    mode nsv   nsu nva variate    min   mean median    max Nas type outm</span></span>
<span><span class="co">#&gt; 1    x numeric   1 10000   2       1 0.0139 0.0175 0.0174 0.0217   0    U each</span></span>
<span><span class="co">#&gt; 2    x numeric   1 10000   2       2 0.0477 0.0787 0.0783 0.1178   0    U each</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="when-to-use-mcmodule">When to use mcmodule?<a class="anchor" aria-label="anchor" href="#when-to-use-mcmodule"></a>
</h3>
<p>The <code>mc2d</code> multivariate approach works well for basic
multivariate risk analysis. However, if instead of purchasing one cow,
you’re dealing with multiple cattle purchases, from different farms,
across different pathogens, scenarios, and age categories, or modelling
multiple risk pathways with different what-if scenarios, this approach
becomes unwieldy.</p>
<p><code>mcmodule</code> addresses these challenges by providing
functions for <strong>multivariate operations</strong> and
<strong>modular management</strong> of the risk model. It automates the
process of creating mcnodes and assigns metadata to them (making it easy
to identify which variate corresponds to which data row). Thanks to this
mcnode metadata, it enables row-matching between nodes with different
variates, combines probabilities across variates, and calculates
multilevel trials. As your risk analysis grows, you can create separate
modules for different pathways, each with independent parameters,
expressions, and scenarios that can later be connected into a complete
model.</p>
<p>This package is particularly useful for:</p>
<ul>
<li><p><strong>Working with complex models</strong> that involve
multiple pathways, pathogens, or scenarios simultaneously</p></li>
<li><p><strong>Dealing with large parameter sets</strong> (hundreds or
thousands of parameters)</p></li>
<li><p><strong>Handling different numbers of variates</strong> across
different parts of your model that need to be combined</p></li>
<li><p><strong>Creating modular risk assessments</strong> where
different components need to be developed independently but later
integrated (for example in collaborative projects)</p></li>
<li><p><strong>Performing sophisticated sensitivity analyses</strong>
across multiple model components</p></li>
</ul>
<p>However, for simpler analyses, such as single pathway models,
exploratory work, small models with few parameters, one-off analyses or
learning risk assessment <code>mcmodule</code>’s additional structure
may be unnecessary.</p>
</div>
<div class="section level3">
<h3 id="installing-mcmodule">Installing mcmodule<a class="anchor" aria-label="anchor" href="#installing-mcmodule"></a>
</h3>
<p>Now, let’s explore the package! We can install it from CRAN:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"mcmodule"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://nataliaciria.github.io/mcmodule/">"mcmodule"</a></span><span class="op">)</span></span></code></pre></div>
<p>Or install latest development version from GitHub (requires
<code>devtool</code> package):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"NataliaCiria/mcmodule"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://nataliaciria.github.io/mcmodule/">"mcmodule"</a></span><span class="op">)</span></span></code></pre></div>
<p>Other recommended packages to load along with mcmodule are:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages(c("dplyr","ggplot2","igraph","visNetwork"))</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> <span class="co"># Data manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span> <span class="co"># Network analysis</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://datastorm-open.github.io/visNetwork/" class="external-link">visNetwork</a></span><span class="op">)</span> <span class="co"># Interactive network visualization</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="building-an-mcmodule">Building an mcmodule<a class="anchor" aria-label="anchor" href="#building-an-mcmodule"></a>
</h2>
<p>To quickly understand the key components of an mcmodule, we’ll start
by building one using the animal imports example included in the
package.</p>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>Let’s consider a scenario where we want to evaluate the risk of
introducing pathogen A and pathogen B into our region from animal
imports from different regions (north, south, east, and west). We have
gathered the following data:</p>
<ul>
<li>
<p><code>animal_imports</code>: number of animal imports with their
mean and standard deviation values per region, and the number of
exporting farms in each region.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">animal_imports</span></span>
<span><span class="co">#&gt;   origin farms_n animals_n_mean animals_n_sd</span></span>
<span><span class="co">#&gt; 1   nord       5            100            6</span></span>
<span><span class="co">#&gt; 2  south      10            130           10</span></span>
<span><span class="co">#&gt; 3   east       7            140           12</span></span></code></pre></div>
</li>
<li>
<p><code>prevalence_region</code>: estimates for both herd and
within-herd prevalence ranges for pathogens A and B, as well as an
indicator of how often tests are performed in origin</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prevalence_region</span></span>
<span><span class="co">#&gt;   pathogen origin h_prev_min h_prev_max w_prev_min w_prev_max test_origin</span></span>
<span><span class="co">#&gt; 1        a   nord       0.08       0.10       0.15        0.2   sometimes</span></span>
<span><span class="co">#&gt; 2        a  south       0.02       0.05       0.15        0.2   sometimes</span></span>
<span><span class="co">#&gt; 3        a   east       0.10       0.15       0.15        0.2       never</span></span>
<span><span class="co">#&gt; 4        b   nord       0.50       0.70       0.45        0.6      always</span></span>
<span><span class="co">#&gt; 5        b  south       0.25       0.30       0.37        0.4   sometimes</span></span>
<span><span class="co">#&gt; 6        b   east       0.30       0.50       0.45        0.6     unknown</span></span></code></pre></div>
</li>
<li>
<p><code>test_sensitivity</code>: estimates of test sensitivity
values for pathogen A and B</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_sensitivity</span></span>
<span><span class="co">#&gt;   pathogen test_sensi_min test_sensi_mode test_sensi_max</span></span>
<span><span class="co">#&gt; 1        a           0.89            0.90           0.91</span></span>
<span><span class="co">#&gt; 2        b           0.80            0.85           0.90</span></span></code></pre></div>
</li>
</ul>
<p>Now we will use <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">dplyr::left_join()</a></code> to create our imports
module data:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports_data</span> <span class="op">&lt;-</span> <span class="va">prevalence_region</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">animal_imports</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">test_sensitivity</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">pathogen</span>, <span class="va">origin</span>, <span class="va">test_origin</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(origin)`</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(pathogen)`</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-keys">Data keys<a class="anchor" aria-label="anchor" href="#data-keys"></a>
</h3>
<p>From now on we will use only the merged <code>imports_data</code>
table. However, it is useful to understand which input dataset each
parameter comes from, as each dataset provides information for different
keys. In this context, keys are fields that (combined) uniquely identify
each row in a table. In our example:</p>
<ul>
<li><p><code>animal_imports</code> provided information by region of
<code>"origin"</code></p></li>
<li><p><code>prevalence_region</code> provided information by
<code>"pathogen"</code> and region of <code>"origin"</code></p></li>
<li><p><code>test_sensitivity</code> provided information by
<code>"pathogen"</code> only</p></li>
</ul>
<p>The resulting merged table, <code>imports_data</code>, will therefore
have two keys: <code>"pathogen"</code> and <code>"origin"</code>.
However, not all parameters will use both keys, for example,
<code>"test_sensi"</code> only has information by
<code>"pathogen"</code>. Knowing the keys for each parameter is crucial
when performing multivariate operations, such as <a href="https://nataliaciria.github.io/mcmodule/articles/intro.html#calculating-totals">calculating
totals</a>.</p>
<p>To make these relationships explicit in the model, we need to provide
the data keys. These are defined in a list with one element for each
input dataset, specifying both the columns and the keys for each
dataset.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports_data_keys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  animal_imports <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">animal_imports</span><span class="op">)</span>,</span>
<span>    keys <span class="op">=</span> <span class="st">"origin"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  prevalence_region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">prevalence_region</span><span class="op">)</span>,</span>
<span>    keys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pathogen"</span>, <span class="st">"origin"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  test_sensitivity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">test_sensitivity</span><span class="op">)</span>,</span>
<span>    keys <span class="op">=</span> <span class="st">"pathogen"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="mcnodes-table">mcnodes table<a class="anchor" aria-label="anchor" href="#mcnodes-table"></a>
</h3>
<p>With values and keys established, we still need some information to
build our stochastic parameters. The mcnode table specifies how to build
mcnodes from the data table. It specifies which parameters are included
in the model, the type of parameters (those with an mc_func are
stochastic), and what columns to look for in the data table to build
these mcnodes (the name of the mcnode, or another variable in the data
columns), as well as transformations that are useful to encode
categorical data values into mcnodes that must always be numeric.</p>
<ul>
<li><p>mcnode: Name of the Monte Carlo node (required)</p></li>
<li><p>description: Description of the parameter</p></li>
<li><p>mc_func: Probability distribution</p></li>
<li><p>from_variable: Column name, if it comes from a column with a name
different to the mcnode</p></li>
<li><p>transformation: Transformation to be applied to the original
column values</p></li>
<li><p>sensi_analysis: Whether to include in sensitivity analysis<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;This column is planned for future versions, as functions
for uncertainty, sensitivity, and convergence analysis are currently
under development and will be included in the next package&lt;/p&gt;"><sup>2</sup></a></p></li>
</ul>
<p>Here we have the <code>imports_mctable</code> for our example. While
the mctable can be hard-coded in R, it’s more efficient to prepare it in
a CSV or other external file. This approach also allows the table to be
included as part of the model documentation.</p>
<table class="table">
<colgroup>
<col width="7%">
<col width="33%">
<col width="3%">
<col width="6%">
<col width="43%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">mcnode</th>
<th align="left">description</th>
<th align="left">mc_func</th>
<th align="left">from_variable</th>
<th align="left">transformation</th>
<th align="left">sensi_analysis</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">h_prev</td>
<td align="left">Herd prevalence</td>
<td align="left">runif</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">w_prev</td>
<td align="left">Within herd prevalence</td>
<td align="left">runif</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">test_sensi</td>
<td align="left">Test sensitivity</td>
<td align="left">rpert</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">farms_n</td>
<td align="left">Number of farms exporting animals</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">animals_n</td>
<td align="left">Number of animals exported per farm</td>
<td align="left">rnorm</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">test_origin_unk</td>
<td align="left">Unknown probability of the animals being tested in
origin (true = unknown)</td>
<td align="left">NA</td>
<td align="left">test_origin</td>
<td align="left">value==“unknown”</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">test_origin</td>
<td align="left">Probability of the animals being tested in origin</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">ifelse(value == “always”, 1, ifelse(value ==
“sometimes”, 0.5, ifelse(value == “never”, 0, NA)))</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>The data table and the mctable must complement each other:</p>
<ul>
<li><p>mcnodes without an <code>mc_func</code> (like
<code>farms_n</code>), needs the matching column name
(<code>"farms_n"</code>) in the data table</p></li>
<li>
<p>mcnodes with an <code>mc_func</code>, you need <strong>columns
for each probability distribution argument in the</strong> <strong>data
table</strong>. For example:</p>
<ul>
<li><p><code>h_prev</code> with <code>runif</code> distribution requires
<code>"h_prev_min"</code> and <code>"h_prev_max"</code></p></li>
<li><p><code>animals_n</code> with <code>rnorm</code> distribution
requires <code>"animals_n_mean"</code> and
<code>"animals_n_sd"</code></p></li>
</ul>
</li>
</ul>
<p>For encoding categorical variables as mcnodes (or any other data
transformation), you can use any R code with <code>value</code> as a
placeholder for the mcnode name or column name (specified in
<code>from_variable</code>)</p>
</div>
<div class="section level3">
<h3 id="expressions">Expressions<a class="anchor" aria-label="anchor" href="#expressions"></a>
</h3>
<p>Finally, we need to write the model’s mathematical expression. These
expressions should ideally include only arithmetic operations, not R
functions (with some exceptions that will be covered later in “<a href="https://nataliaciria.github.io/mcmodule/articles/intro.html#tricks-and-tweaks">tricks
and tweaks</a>”). We’ll wrap them using <code><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote()</a></code> so they
aren’t executed immediately but stored for later evaluation with
<code>eval_model()</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports_exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="co"># Probability that an animal in an infected herd is infected (a = animal)</span></span>
<span>  <span class="va">infected</span> <span class="op">&lt;-</span> <span class="va">w_prev</span></span>
<span>  <span class="co"># Probability an animal is tested and is a false negative</span></span>
<span>  <span class="co"># (test specificity assumed to be 100%)</span></span>
<span>  <span class="va">false_neg</span> <span class="op">&lt;-</span> <span class="va">infected</span> <span class="op">*</span> <span class="va">test_origin</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_sensi</span><span class="op">)</span></span>
<span>  <span class="co"># Probability an animal is not tested</span></span>
<span>  <span class="va">no_test</span> <span class="op">&lt;-</span> <span class="va">infected</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">test_origin</span><span class="op">)</span></span>
<span>  <span class="co"># Probability an animal is not detected</span></span>
<span>  <span class="va">no_detect</span> <span class="op">&lt;-</span> <span class="va">false_neg</span> <span class="op">+</span> <span class="va">no_test</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="evaluating-an-mcmodule">Evaluating an mcmodule<a class="anchor" aria-label="anchor" href="#evaluating-an-mcmodule"></a>
</h3>
<p>With all components in place, we’re now ready to create our first
mcmodule using <code><a href="../reference/eval_module.html">eval_module()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eval_module.html">eval_module</a></span><span class="op">(</span></span>
<span>  exp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>imports <span class="op">=</span> <span class="va">imports_exp</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">imports_data</span>,</span>
<span>  mctable <span class="op">=</span> <span class="va">imports_mctable</span>,</span>
<span>  data_keys <span class="op">=</span> <span class="va">imports_data_keys</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; imports evaluated</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; mcmodule created (expressions: imports)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">imports</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "mcmodule"</span></span></code></pre></div>
<p>An mcmodule is an S3 object class, and it is essentially a list that
contains all risk assessment components in a structured format.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">imports</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "data"      "exp"       "node_list" "modules"</span></span></code></pre></div>
<p>The mcmodule contains the input <code>data</code> and mathematical
expressions (<code>exp</code>) that ensure traceability. All input and
calculated parameters are stored in <code>node_list</code>. Each node
contains not only the mcnode itself but also important metadata: node
type (input or output), source dataset and columns, keys, calculation
method, and more. The specific metadata varies depending on the node’s
characteristics. Here are a few examples:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports</span><span class="op">$</span><span class="va">node_list</span><span class="op">$</span><span class="va">w_prev</span></span>
<span><span class="co">#&gt; $type</span></span>
<span><span class="co">#&gt; [1] "in_node"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mc_func</span></span>
<span><span class="co">#&gt; [1] "runif"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $description</span></span>
<span><span class="co">#&gt; [1] "Within herd prevalence"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $inputs_col</span></span>
<span><span class="co">#&gt; [1] "w_prev_min" "w_prev_max"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $input_dataset</span></span>
<span><span class="co">#&gt; [1] "prevalence_region"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $keys</span></span>
<span><span class="co">#&gt; [1] "pathogen" "origin"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $module</span></span>
<span><span class="co">#&gt; [1] "imports"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mc_name</span></span>
<span><span class="co">#&gt; [1] "w_prev"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mcnode</span></span>
<span><span class="co">#&gt;   node    mode  nsv nsu nva variate  min  mean median max Nas type outm</span></span>
<span><span class="co">#&gt; 1    x numeric 1001   1   6       1 0.15 0.175  0.175 0.2   0    V each</span></span>
<span><span class="co">#&gt; 2    x numeric 1001   1   6       2 0.15 0.175  0.173 0.2   0    V each</span></span>
<span><span class="co">#&gt; 3    x numeric 1001   1   6       3 0.15 0.176  0.176 0.2   0    V each</span></span>
<span><span class="co">#&gt; 4    x numeric 1001   1   6       4 0.45 0.524  0.524 0.6   0    V each</span></span>
<span><span class="co">#&gt; 5    x numeric 1001   1   6       5 0.37 0.385  0.385 0.4   0    V each</span></span>
<span><span class="co">#&gt; 6    x numeric 1001   1   6       6 0.45 0.525  0.525 0.6   0    V each</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data_name</span></span>
<span><span class="co">#&gt; [1] "imports_data"</span></span>
<span><span class="va">imports</span><span class="op">$</span><span class="va">node_list</span><span class="op">$</span><span class="va">no_detect</span></span>
<span><span class="co">#&gt; $node_exp</span></span>
<span><span class="co">#&gt; [1] "false_neg + no_test"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $type</span></span>
<span><span class="co">#&gt; [1] "out_node"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $inputs</span></span>
<span><span class="co">#&gt; [1] "false_neg" "no_test"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $module</span></span>
<span><span class="co">#&gt; [1] "imports"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mc_name</span></span>
<span><span class="co">#&gt; [1] "no_detect"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $keys</span></span>
<span><span class="co">#&gt; [1] "pathogen" "origin"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $param</span></span>
<span><span class="co">#&gt; [1] "false_neg" "no_test"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mcnode</span></span>
<span><span class="co">#&gt;   node    mode  nsv nsu nva variate    min   mean median   max Nas type outm</span></span>
<span><span class="co">#&gt; 1    x numeric 1001   1   6       1 0.0823 0.0961 0.0962 0.111   0    V each</span></span>
<span><span class="co">#&gt; 2    x numeric 1001   1   6       2 0.0821 0.0960 0.0954 0.110   0    V each</span></span>
<span><span class="co">#&gt; 3    x numeric 1001   1   6       3 0.1501 0.1758 0.1758 0.200   0    V each</span></span>
<span><span class="co">#&gt; 4    x numeric 1001   1   6       4 0.0473 0.0789 0.0783 0.113   0    V each</span></span>
<span><span class="co">#&gt; 5    x numeric 1001   1   6       5 0.2056 0.2216 0.2216 0.237   0    V each</span></span>
<span><span class="co">#&gt; 6    x numeric 1001   1   6       6 0.4501 0.5250 0.5251 0.600   0    V each</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data_name</span></span>
<span><span class="co">#&gt; [1] "imports_data"</span></span></code></pre></div>
<p>And now that we have an mcmodule, we can begin exploring its
possibilities!</p>
</div>
<div class="section level3">
<h3 id="understanding-mcnodes-operations">Understanding mcnodes operations<a class="anchor" aria-label="anchor" href="#understanding-mcnodes-operations"></a>
</h3>
<p>When arithmetic operations are performed between nodes in mcmodule,
they are applied on matching elements and keep the original dimensions,
allowing uncertainties and variates to propagate through the
calculations.</p>
<p><img src="images/mcmodule_mcnode_element-wise_operation.png" style="display: block; margin: 1em auto;width:100.0%" fig-align="center"></p>
</div>
</div>
<div class="section level2">
<h2 id="working-with-an-mcmodule">Working with an mcmodule<a class="anchor" aria-label="anchor" href="#working-with-an-mcmodule"></a>
</h2>
<div class="section level3">
<h3 id="visualizing">Visualizing<a class="anchor" aria-label="anchor" href="#visualizing"></a>
</h3>
<p>We can visualize an mc_module with the <code><a href="../reference/mc_network.html">mc_network()</a></code>
function. For this, you will need to have <code>igraph</code> <span class="citation">(<a href="#ref-igraph">Csardi and Nepusz
2006</a>)</span> and <code>visNetwork</code> <span class="citation">(<a href="#ref-visnetwork">Almende B. V. and Benoit Thieurmel
2025</a>)</span> installed.</p>
<p>In these network visualizations, input datasets appear in blue, input
data files, input columns and input mcnodes appear in different shades
of dark-grey-blue, output mcnodes in green, and total mcnodes (as we
will see later) in orange. The numbers displayed when clicked correspond
to the median and the 95% confidence interval of the first variate of
each mcnode.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mc_network.html">mc_network</a></span><span class="op">(</span><span class="va">imports</span>, legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:432.632880098888px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"nodes":{"id":["w_prev","test_origin","test_sensi","infected","false_neg","no_test","no_detect"],"color":["#6ABDEB","#6ABDEB","#6ABDEB","#A4CF96","#A4CF96","#A4CF96","#A4CF96"],"color_by":["in_node","in_node","in_node","out_node","out_node","out_node","out_node"],"grouping":["imports","imports","imports","imports","imports","imports","imports"],"expression":["runif","mcdata","rpert","w_prev","infected * test_origin * (1 - test_sensi)","infected * (1 - test_origin)","false_neg + no_test"],"title":["<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>w_prev<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>17.51% (15.11%-19.86%)<br><\/strong>runif<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">w_prev_min<br> w_prev_max<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>test_origin<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.5<br><\/strong>mcdata<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">test_origin<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>test_sensi<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>89.96% (89.29%-90.7%)<br><\/strong>rpert<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">test_sensi_min<br> test_sensi_mode<br> test_sensi_max<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>infected<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>17.51% (15.11%-19.86%)<br><\/strong>w_prev<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">w_prev<\/td>\n          <td style=\"width: 50%; text-align: center;\">w_prev<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>false_neg<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.87% (0.74%-1.03%)<br><\/strong>infected * test_origin * (1 - test_sensi)<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">infected<br> test_origin<br> test_sensi<\/td>\n          <td style=\"width: 50%; text-align: center;\">infected<br> test_origin<br> test_sensi<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_test<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>8.76% (7.55%-9.93%)<br><\/strong>infected * (1 - test_origin)<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">infected<br> test_origin<\/td>\n          <td style=\"width: 50%; text-align: center;\">infected<br> test_origin<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>9.62% (8.32%-10.92%)<br><\/strong>false_neg + no_test<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">false_neg<br> no_test<\/td>\n          <td style=\"width: 50%; text-align: center;\">false_neg<br> no_test<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>"],"type":["in_node","in_node","in_node","out_node","out_node","out_node","out_node"],"label":["w_prev","test_origin","test_sensi","infected","false_neg","no_test","no_detect"],"x":[-1,0,1,-1,0.5,-1,-0.5],"y":[-1,-1,-1,-0.3333333333333334,0.3333333333333333,0.3333333333333333,1]},"edges":{"from":["w_prev","infected","test_origin","test_sensi","infected","test_origin","false_neg","no_test"],"to":["infected","false_neg","false_neg","false_neg","no_test","no_test","no_detect","no_detect"],"id":[1,2,3,4,5,6,7,8]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"arrows":"to","smooth":false},"physics":{"enabled":false},"interaction":{"dragNodes":true,"zoomSpeed":1}},"groups":["imports"],"width":"100%","height":null,"idselection":{"enabled":true,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":true,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false,"variable":"grouping","main":"Select by grouping","values":["imports"]},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":2,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":false,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":false,"nodes":{"label":["in_node","out_node"],"color":["#6ABDEB","#A4CF96"],"shape":["dot","dot"],"title":["Node type","Node type"],"font.size":[15,15]},"nodesToDataframe":true}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="sec-calculating-totals">Summarizing<a class="anchor" aria-label="anchor" href="#sec-calculating-totals"></a>
</h3>
<p>In the imports mcmodule, we can already see the raw mcnode results
for the probability of an imported animal not being detected
(<code>no_detect</code>). However, it’s difficult to determine which
pathogen or region these results refer to. The <code><a href="../reference/mc_summary.html">mc_summary()</a></code>
function solves this problem by linking mcnode results with their key
columns in the data.</p>
<blockquote>
<p>Note that while the printed summary looks similar to the raw mcnode,
it’s actually just a dataframe containing statistical measures, whereas
the actual mcnode is a large array of numbers with dimensions
(uncertainty × 1 × variates),</p>
</blockquote>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mc_summary.html">mc_summary</a></span><span class="op">(</span>mcmodule <span class="op">=</span> <span class="va">imports</span>, mc_name <span class="op">=</span> <span class="st">"no_detect"</span><span class="op">)</span></span>
<span><span class="co">#&gt;     mc_name pathogen origin       mean          sd        Min       2.5%</span></span>
<span><span class="co">#&gt; 1 no_detect        a   nord 0.09606117 0.007846092 0.08229964 0.08315677</span></span>
<span><span class="co">#&gt; 2 no_detect        a  south 0.09600480 0.007853480 0.08211744 0.08335069</span></span>
<span><span class="co">#&gt; 3 no_detect        a   east 0.17576742 0.014232780 0.15012421 0.15143865</span></span>
<span><span class="co">#&gt; 4 no_detect        b   nord 0.07893257 0.011945867 0.04733962 0.05755650</span></span>
<span><span class="co">#&gt; 5 no_detect        b  south 0.22158127 0.006342677 0.20562155 0.21003466</span></span>
<span><span class="co">#&gt; 6 no_detect        b   east 0.52501566 0.044450307 0.45010788 0.45180481</span></span>
<span><span class="co">#&gt;          25%        50%        75%     97.5%       Max  nsv Na's</span></span>
<span><span class="co">#&gt; 1 0.08935080 0.09624474 0.10277116 0.1091880 0.1106308 1001    0</span></span>
<span><span class="co">#&gt; 2 0.08962080 0.09541026 0.10270101 0.1094114 0.1103462 1001    0</span></span>
<span><span class="co">#&gt; 3 0.16410730 0.17582400 0.18797380 0.1986464 0.1999425 1001    0</span></span>
<span><span class="co">#&gt; 4 0.06985123 0.07826653 0.08704084 0.1028250 0.1130751 1001    0</span></span>
<span><span class="co">#&gt; 5 0.21693959 0.22159777 0.22614771 0.2338717 0.2372087 1001    0</span></span>
<span><span class="co">#&gt; 6 0.48700830 0.52505400 0.56319271 0.5974721 0.5999797 1001    0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculating-totals">Calculating totals<a class="anchor" aria-label="anchor" href="#calculating-totals"></a>
</h3>
<p>Most of the following probability calculations are based on Chapter 5
of the <em>Handbook on Import Risk Analysis for Animals and Animal
Products Volume 2. Quantitative risk assessment</em> <span class="citation">(<a href="#ref-Murray2004">Murray 2004</a>)</span>.
More details can be found on the <a href="https://nataliaciria.github.io/mcmodule/articles/multivariate_operations.html"><em>Multivariate
operations</em></a> vignette.</p>
<div class="section level4">
<h4 id="single-level-trials">Single-level trials<a class="anchor" aria-label="anchor" href="#single-level-trials"></a>
</h4>
<p>In <code>imports</code>, we know the probability that an infected
animal from an infected farm goes undetected (<code>"no_detect"</code>).
We can use the total number of animals selected per farm
(<code>"animals_n"</code>) as the number of trials
(<code>trials_n</code>) to determine the probability that at least one
infected animal from an infected farm is not detected
(<code>no_detect_set</code>).</p>
<p>In single-level trials, each trial is independent with the same
probability of success
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>l</mi><mi>_</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">trial\_p</annotation></semantics></math>).
For a set of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>_</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">trials\_n</annotation></semantics></math>
trials, the <strong>probability of at least one success</strong> is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>e</mi><mi>t</mi><mi>_</mi><mi>p</mi><mo>=</mo><mn>1</mn><mo>−</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>t</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>l</mi><mi>_</mi><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>t</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>_</mi><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex"> set\_p= 1-(1-trial\_p)^{trials\_n} </annotation></semantics></math></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Probability of at least one imported animal from an infected herd is not detected</span></span>
<span><span class="va">imports</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trial_totals.html">trial_totals</a></span><span class="op">(</span></span>
<span>  mcmodule <span class="op">=</span> <span class="va">imports</span>,</span>
<span>  mc_names <span class="op">=</span> <span class="st">"no_detect"</span>,</span>
<span>  trials_n <span class="op">=</span> <span class="st">"animals_n"</span>,</span>
<span>  mctable <span class="op">=</span> <span class="va">imports_mctable</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; data_name is not equal for all nodes, using 'no_detect' data_name 'imports_data' for node creation</span></span></code></pre></div>
<p>The <code><a href="../reference/trial_totals.html">trial_totals()</a></code> function returns the mcmodule with
some additional nodes: the probability of at least one success and the
expected number of successes. These <strong>total nodes</strong> have
special metadata fields, and always include a summary by default.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Probability of at least one</span></span>
<span><span class="va">imports</span><span class="op">$</span><span class="va">node_list</span><span class="op">$</span><span class="va">no_detect_set</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt;         mc_name pathogen origin      mean           sd       Min      2.5%</span></span>
<span><span class="co">#&gt; 1 no_detect_set        a   nord 0.9999321 7.013890e-05 0.9994040 0.9997494</span></span>
<span><span class="co">#&gt; 2 no_detect_set        a  south 0.9999946 9.023932e-06 0.9999207 0.9999693</span></span>
<span><span class="co">#&gt; 3 no_detect_set        a   east 1.0000000 7.143640e-10 1.0000000 1.0000000</span></span>
<span><span class="co">#&gt; 4 no_detect_set        b   nord 0.9993863 9.111167e-04 0.9878926 0.9969435</span></span>
<span><span class="co">#&gt; 5 no_detect_set        b  south 1.0000000 8.284954e-13 1.0000000 1.0000000</span></span>
<span><span class="co">#&gt; 6 no_detect_set        b   east 1.0000000 0.000000e+00 1.0000000 1.0000000</span></span>
<span><span class="co">#&gt;         25%       50%       75%     97.5%       Max  nsv Na's</span></span>
<span><span class="co">#&gt; 1 0.9999111 0.9999592 0.9999798 0.9999942 0.9999990 1001    0</span></span>
<span><span class="co">#&gt; 2 0.9999940 0.9999979 0.9999993 0.9999999 1.0000000 1001    0</span></span>
<span><span class="co">#&gt; 3 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1001    0</span></span>
<span><span class="co">#&gt; 4 0.9992577 0.9997108 0.9998988 0.9999820 0.9999967 1001    0</span></span>
<span><span class="co">#&gt; 5 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1001    0</span></span>
<span><span class="co">#&gt; 6 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1001    0</span></span>
<span></span>
<span><span class="co"># Expected number of animals</span></span>
<span><span class="va">imports</span><span class="op">$</span><span class="va">node_list</span><span class="op">$</span><span class="va">no_detect_set_n</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt;           mc_name pathogen origin      mean        sd       Min      2.5%</span></span>
<span><span class="co">#&gt; 1 no_detect_set_n        a   nord  9.589398 0.9471878  7.098067  7.925178</span></span>
<span><span class="co">#&gt; 2 no_detect_set_n        a  south 12.457595 1.3808264  9.034427  9.929288</span></span>
<span><span class="co">#&gt; 3 no_detect_set_n        a   east 24.646773 2.8240560 16.479434 19.584162</span></span>
<span><span class="co">#&gt; 4 no_detect_set_n        b   nord  7.888526 1.2851499  4.308618  5.606024</span></span>
<span><span class="co">#&gt; 5 no_detect_set_n        b  south 28.924510 2.4160939 21.816997 24.386809</span></span>
<span><span class="co">#&gt; 6 no_detect_set_n        b   east 73.810011 9.1186665 49.777486 56.520429</span></span>
<span><span class="co">#&gt;         25%       50%       75%    97.5%       Max  nsv Na's</span></span>
<span><span class="co">#&gt; 1  8.899716  9.604395 10.255537 11.39188  13.10031 1001    0</span></span>
<span><span class="co">#&gt; 2 11.445423 12.454098 13.394556 15.13293  16.59565 1001    0</span></span>
<span><span class="co">#&gt; 3 22.596941 24.540466 26.556945 30.52778  33.49197 1001    0</span></span>
<span><span class="co">#&gt; 4  6.953646  7.820599  8.794037 10.42509  11.94095 1001    0</span></span>
<span><span class="co">#&gt; 5 27.267935 28.918348 30.489151 33.80466  35.92125 1001    0</span></span>
<span><span class="co">#&gt; 6 67.359386 73.486767 80.290275 91.55168 104.93881 1001    0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="multilevel-trials">Multilevel trials<a class="anchor" aria-label="anchor" href="#multilevel-trials"></a>
</h4>
<div class="section level5">
<h5 id="simple-multilevel">Simple multilevel<a class="anchor" aria-label="anchor" href="#simple-multilevel"></a>
</h5>
<p>We can also calculate the probability that at least one infected
animal from at least one infected farm is not detected, but here, we
need to consider two levels: animals and farms.</p>
<div class="float">
<img src="images/mcmodule_multilevel_trial_drawing.png" alt="Selection (in blue) of 4 animals from 3 farms, with a 20% regional herd prevalence and 50% within-herd prevalence."><div class="figcaption"><em>Selection (in blue) of 4 animals from 3
farms, with a 20% regional herd prevalence and 50% within-herd
prevalence.</em></div>
</div>
<p>We import animals from <code>"farms_n"</code> farms. Each farm has a
probability <code>"h_prev"</code> (regional herd prevalence) of being
infected. From each farm, we import <code>"animals_n"</code> animals. In
an infected farm, each animal has a probability <code>"w_prev"</code>
(within-herd prevalence) of being infected. We’ve already used this to
calculate <code>"no_detect"</code>, which is the probability that an
infected animal is not detected.</p>
<p><img src="images/mcmodule_multilevel_trial_diagram.png"></p>
<p>The probability of at least one success in this hierarchical
structure is given by:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>e</mi><mi>t</mi><mi>_</mi><mi>p</mi><mo>=</mo><mn>1</mn><mo>−</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>s</mi><mi>u</mi><mi>b</mi><mi>s</mi><mi>e</mi><mi>t</mi><mi>_</mi><mi>p</mi><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>t</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>l</mi><mi>_</mi><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>t</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>l</mi><mi>_</mi><mi>n</mi></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>s</mi><mi>u</mi><mi>b</mi><mi>s</mi><mi>e</mi><mi>t</mi><mi>_</mi><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex"> set\_p= 1-(1-subset\_p \cdot (1-(1-trial\_p)^{trial\_n}))^{subset\_n}  </annotation></semantics></math></p>
<p>Where:</p>
<ul>
<li><p><em>trials_p</em> represents the probability of a trial in a
subset being a success</p></li>
<li><p><em>trials_n</em> represents the number of trials in
subset</p></li>
<li><p><em>subset_p</em> represents the probability of a subset being
selected</p></li>
<li><p><em>subset_n</em> represents the number of subsets</p></li>
<li><p><em>set_p</em> represents the probability of a at least one trial
of at least one subset being a success</p></li>
</ul>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Probability of at least one animal from at least one herd being is not detected (probability of a herd being infected: h_prev)</span></span>
<span><span class="va">imports</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trial_totals.html">trial_totals</a></span><span class="op">(</span></span>
<span>  mcmodule <span class="op">=</span> <span class="va">imports</span>,</span>
<span>  mc_names <span class="op">=</span> <span class="st">"no_detect"</span>,</span>
<span>  trials_n <span class="op">=</span> <span class="st">"animals_n"</span>,</span>
<span>  subsets_n <span class="op">=</span> <span class="st">"farms_n"</span>,</span>
<span>  subsets_p <span class="op">=</span> <span class="st">"h_prev"</span>,</span>
<span>  mctable <span class="op">=</span> <span class="va">imports_mctable</span>,</span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; data_name is not equal for all nodes, using 'animals_n' data_name 'imports_data' for node creation</span></span>
<span></span>
<span><span class="co"># Result</span></span>
<span><span class="va">imports</span><span class="op">$</span><span class="va">node_list</span><span class="op">$</span><span class="va">no_detect_set</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt;         mc_name pathogen origin      mean          sd       Min      2.5%</span></span>
<span><span class="co">#&gt; 1 no_detect_set        a   nord 0.3750658 0.019423805 0.3409096 0.3426622</span></span>
<span><span class="co">#&gt; 2 no_detect_set        a  south 0.2996147 0.062082135 0.1831011 0.1880185</span></span>
<span><span class="co">#&gt; 3 no_detect_set        a   east 0.6033211 0.044910761 0.5223697 0.5281263</span></span>
<span><span class="co">#&gt; 4 no_detect_set        b   nord 0.9879346 0.008092032 0.9685386 0.9700096</span></span>
<span><span class="co">#&gt; 5 no_detect_set        b  south 0.9591725 0.008198048 0.9436984 0.9446557</span></span>
<span><span class="co">#&gt; 6 no_detect_set        b   east 0.9666202 0.020854527 0.9178026 0.9227233</span></span>
<span><span class="co">#&gt;         25%       50%       75%     97.5%       Max  nsv Na's</span></span>
<span><span class="co">#&gt; 1 0.3584187 0.3754377 0.3919736 0.4074487 0.4093251 1001    0</span></span>
<span><span class="co">#&gt; 2 0.2502976 0.3010584 0.3531750 0.3983723 0.4010640 1001    0</span></span>
<span><span class="co">#&gt; 3 0.5654920 0.6014358 0.6445998 0.6758861 0.6789184 1001    0</span></span>
<span><span class="co">#&gt; 4 0.9820674 0.9903868 0.9947567 0.9972808 0.9975589 1001    0</span></span>
<span><span class="co">#&gt; 5 0.9519908 0.9594851 0.9664197 0.9713592 0.9717380 1001    0</span></span>
<span><span class="co">#&gt; 6 0.9515323 0.9719872 0.9843585 0.9916945 0.9921818 1001    0</span></span></code></pre></div>
<p>It also provides the probability of at least one and the expected
number of infected animals by subset (in this case a farm)</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Probability of at least one in a farm</span></span>
<span><span class="va">imports</span><span class="op">$</span><span class="va">node_list</span><span class="op">$</span><span class="va">no_detect_subset</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt;            mc_name pathogen origin       mean          sd        Min       2.5%</span></span>
<span><span class="co">#&gt; 1 no_detect_subset        a   nord 0.08980737 0.005660661 0.07999752 0.08048733</span></span>
<span><span class="co">#&gt; 2 no_detect_subset        a  south 0.03532634 0.008548798 0.02002086 0.02061238</span></span>
<span><span class="co">#&gt; 3 no_detect_subset        a   east 0.12443077 0.014260146 0.10017930 0.10173663</span></span>
<span><span class="co">#&gt; 4 no_detect_subset        b   nord 0.60225288 0.057082160 0.49932532 0.50409716</span></span>
<span><span class="co">#&gt; 5 no_detect_subset        b  south 0.27506880 0.014724809 0.25001588 0.25130089</span></span>
<span><span class="co">#&gt; 6 no_detect_subset        b   east 0.40038052 0.057432337 0.30019068 0.30633494</span></span>
<span><span class="co">#&gt;          25%        50%        75%      97.5%        Max  nsv Na's</span></span>
<span><span class="co">#&gt; 1 0.08493839 0.08984544 0.09471675 0.09937252 0.09994365 1001    0</span></span>
<span><span class="co">#&gt; 2 0.02839691 0.03518491 0.04263250 0.04954233 0.04996842 1001    0</span></span>
<span><span class="co">#&gt; 3 0.11226079 0.12314390 0.13738540 0.14866661 0.14980902 1001    0</span></span>
<span><span class="co">#&gt; 4 0.55256613 0.60502150 0.65011828 0.69317755 0.69972566 1001    0</span></span>
<span><span class="co">#&gt; 5 0.26187070 0.27429279 0.28778932 0.29903139 0.29996406 1001    0</span></span>
<span><span class="co">#&gt; 6 0.35105566 0.39994117 0.44787181 0.49560966 0.49994811 1001    0</span></span></code></pre></div>
<p><strong>Multiple group multilevel trials</strong></p>
<p>This <code><a href="../reference/trial_totals.html">trial_totals()</a></code> application is beyond the scope of
this vignette, but there are cases where you might have several variates
from the same subset. For example we could deal with different animal
categories (cow, calf, bull…) from the same farm. In this case, the
infection probability of animals within the same farm is not
independent, and this should be taken into account. For more
information, see <a href="https://nataliaciria.github.io/mcmodule/articles/multivariate_operations.html#multilevel-trials">Multilevel
trials</a> in the <em>Multivariate operations</em> vignette.</p>
<div class="float">
<img src="images/mcmodule_multilevel_trial_drawing_groups.png" alt="Selection (in blue) of 2 cows and 5 calves from 3 farms, with a 20% regional herd prevalence and 50% within-herd prevalence for adult animals and 30% within-herd prevalence for young animals."><div class="figcaption"><em>Selection (in blue) of 2 cows and 5 calves
from 3 farms, with a 20% regional herd prevalence and 50% within-herd
prevalence for adult animals and 30% within-herd prevalence for young
animals.</em></div>
</div>
</div>
</div>
<div class="section level4">
<h4 id="aggregated-totals">Aggregated totals<a class="anchor" aria-label="anchor" href="#aggregated-totals"></a>
</h4>
<p>Until this point, all mcnode operations were element-wise, keeping
the original dimensions, and allowing uncertainties and variates to
propagate through the calculations. However, sometimes, we need to
aggregate variates to calculate totals, for example, to total risk of
introducing a pathogen across all regions. In this case, we want to
preserve the uncertainty dimension but reduce the variates dimension.
With <code><a href="../reference/agg_totals.html">agg_totals()</a></code> we can calculate overall probabilities or
sum quantities across groups.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/agg_totals.html">agg_totals</a></span><span class="op">(</span></span>
<span>  mcmodule <span class="op">=</span> <span class="va">imports</span>,</span>
<span>  mc_name <span class="op">=</span> <span class="st">"no_detect_set"</span>,</span>
<span>  agg_keys <span class="op">=</span> <span class="st">"pathogen"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; 3 variates per group for no_detect_set</span></span>
<span></span>
<span><span class="co"># Result</span></span>
<span><span class="va">imports</span><span class="op">$</span><span class="va">node_list</span><span class="op">$</span><span class="va">no_detect_set_agg</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt;             mc_name pathogen      mean           sd       Min      2.5%</span></span>
<span><span class="co">#&gt; 1 no_detect_set_agg        a 0.8263790 2.558766e-02 0.7550627 0.7752397</span></span>
<span><span class="co">#&gt; 4 no_detect_set_agg        b 0.9999839 1.645539e-05 0.9998917 0.9999352</span></span>
<span><span class="co">#&gt;         25%       50%       75%     97.5%       Max  nsv Na's</span></span>
<span><span class="co">#&gt; 1 0.8089823 0.8272920 0.8456831 0.8692203 0.8841334 1001    0</span></span>
<span><span class="co">#&gt; 4 0.9999804 0.9999895 0.9999949 0.9999985 0.9999993 1001    0</span></span></code></pre></div>
<p>Now we can visualize our mcmodule again and see all these new nodes
created by the totals functions.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mc_network.html">mc_network</a></span><span class="op">(</span><span class="va">imports</span>, legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-e5c8c404fe174e4c81bd" style="width:100%;height:432.632880098888px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"nodes":{"id":["w_prev","test_origin","test_sensi","infected","false_neg","no_test","no_detect","animals_n","no_detect_set","no_detect_set_n","farms_n","h_prev","no_detect_trial","no_detect_subset","no_detect_subset_n","no_detect_set_agg"],"color":["#6ABDEB","#6ABDEB","#6ABDEB","#A4CF96","#A4CF96","#A4CF96","#A4CF96","#FAE4CB","#F39200","#F39200","#FAE4CB","#FAE4CB","#F39200","#F39200","#F39200","#C17816"],"color_by":["in_node","in_node","in_node","out_node","out_node","out_node","out_node","trials_n","total","total","subsets_n","subsets_p","total","total","total","agg_total"],"grouping":["imports","imports","imports","imports","imports","imports","imports","imports","imports","imports","imports","imports","imports","imports","imports","imports"],"expression":["runif","mcdata","rpert","w_prev","infected * test_origin * (1 - test_sensi)","infected * (1 - test_origin)","false_neg + no_test",null,null,null,null,null,null,null,null,null],"title":["<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>w_prev<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>17.51% (15.11%-19.86%)<br><\/strong>runif<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">w_prev_min<br> w_prev_max<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>test_origin<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.5<br><\/strong>mcdata<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">test_origin<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>test_sensi<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>89.96% (89.29%-90.7%)<br><\/strong>rpert<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">test_sensi_min<br> test_sensi_mode<br> test_sensi_max<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>infected<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>17.51% (15.11%-19.86%)<br><\/strong>w_prev<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">w_prev<\/td>\n          <td style=\"width: 50%; text-align: center;\">w_prev<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>false_neg<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.87% (0.74%-1.03%)<br><\/strong>infected * test_origin * (1 - test_sensi)<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">infected<br> test_origin<br> test_sensi<\/td>\n          <td style=\"width: 50%; text-align: center;\">infected<br> test_origin<br> test_sensi<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_test<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>8.76% (7.55%-9.93%)<br><\/strong>infected * (1 - test_origin)<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">infected<br> test_origin<\/td>\n          <td style=\"width: 50%; text-align: center;\">infected<br> test_origin<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>9.62% (8.32%-10.92%)<br><\/strong>false_neg + no_test<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">false_neg<br> no_test<\/td>\n          <td style=\"width: 50%; text-align: center;\">false_neg<br> no_test<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>animals_n<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>99.74 (89.03-111.32)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">animals_n_mean<br> animals_n_sd<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect_set<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>37.54% (34.27%-40.74%)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> farms_n<br> h_prev<\/td>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> farms_n<br> h_prev<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect_set_n<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>4.29 (3.42-5.33)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> farms_n<br> h_prev<\/td>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> farms_n<br> h_prev<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>farms_n<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>5<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">farms_n<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>h_prev<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>8.99% (8.05%-9.94%)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">h_prev_min<br> h_prev_max<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect_trial<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.86% (0.71%-1.04%)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> h_prev<\/td>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> h_prev<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect_subset<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>8.98% (8.05%-9.94%)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> h_prev<\/td>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> h_prev<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect_subset_n<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.86 (0.68-1.07)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> h_prev<\/td>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> h_prev<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect_set_agg<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>82.73% (77.52%-86.92%)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">no_detect_set<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>"],"type":["in_node","in_node","in_node","out_node","out_node","out_node","out_node","trials_n","total","total","subsets_n","subsets_p","total","total","total","agg_total"],"label":["w_prev","test_origin","test_sensi","infected","false_neg","no_test","no_detect","animals_n","no_detect_set","no_detect_set_n","farms_n","h_prev","no_detect_trial","no_detect_subset","no_detect_subset_n","no_detect_set_agg"],"x":[0.5555555555555556,0.4074074074074074,-0.7037037037037037,0.1851851851851851,0.03703703703703698,0.2592592592592593,0.1111111111111112,0.03703703703703698,-0.8518518518518519,0.2592592592592593,-1,0.7777777777777777,0.7777777777777777,1,-0.4814814814814815,-0.8518518518518519],"y":[-1,-1,-1,-0.6,-0.2,-0.2,0.2,-1,0.6000000000000001,0.6000000000000001,-1,-1,0.6000000000000001,0.6000000000000001,0.6000000000000001,1]},"edges":{"from":["w_prev","infected","test_origin","test_sensi","infected","test_origin","false_neg","no_test","no_detect","animals_n","farms_n","h_prev","no_detect","animals_n","farms_n","h_prev","no_detect","h_prev","no_detect","animals_n","h_prev","no_detect","animals_n","h_prev","no_detect_set"],"to":["infected","false_neg","false_neg","false_neg","no_test","no_test","no_detect","no_detect","no_detect_set","no_detect_set","no_detect_set","no_detect_set","no_detect_set_n","no_detect_set_n","no_detect_set_n","no_detect_set_n","no_detect_trial","no_detect_trial","no_detect_subset","no_detect_subset","no_detect_subset","no_detect_subset_n","no_detect_subset_n","no_detect_subset_n","no_detect_set_agg"],"id":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"arrows":"to","smooth":false},"physics":{"enabled":false},"interaction":{"dragNodes":true,"zoomSpeed":1}},"groups":["imports"],"width":"100%","height":null,"idselection":{"enabled":true,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":true,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false,"variable":"grouping","main":"Select by grouping","values":["imports"]},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":2,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":false,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":false,"nodes":{"label":["in_node","out_node","trials_info","total","agg_total"],"color":["#6ABDEB","#A4CF96","#FAE4CB","#F39200","#C17816"],"shape":["dot","dot","dot","dot","dot"],"title":["Node type","Node type","Node type","Node type","Node type"],"font.size":[15,15,15,15,15]},"nodesToDataframe":true}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div class="section level2">
<h2 id="working-with-what-if-scenarios">Working with what-if scenarios<a class="anchor" aria-label="anchor" href="#working-with-what-if-scenarios"></a>
</h2>
<p>So far, we’ve only tested our model using current data. But risk
analysis is most useful when comparing different scenarios. In our
example, we could compare the baseline risk with the risk if tests were
always performed in all regions.</p>
<p>To do this this, we only need to add a column called “scenario_id”.
This name is important as it is used to will recognize it specifically
for scenario comparisons, not as regular variate categories. The
baseline scenario should be called “0”. While not every scenario needs
to contain all the variate categories included in the baseline, any
variate categories present in alternative scenarios must exist in the
baseline.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports_data</span> <span class="op">&lt;-</span> <span class="va">imports_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>scenario_id <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">imports_data_wif</span> <span class="op">&lt;-</span> <span class="va">imports_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    scenario_id <span class="op">=</span> <span class="st">"always_test"</span>,</span>
<span>    test_origin <span class="op">=</span> <span class="st">"always"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">imports_data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">scenario_id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">imports_data_wif</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span></span>
<span><span class="co">#&gt;    scenario_id pathogen origin test_origin h_prev_min h_prev_max</span></span>
<span><span class="co">#&gt; 1  always_test        a   nord      always       0.08       0.10</span></span>
<span><span class="co">#&gt; 2  always_test        a  south      always       0.02       0.05</span></span>
<span><span class="co">#&gt; 3  always_test        a   east      always       0.10       0.15</span></span>
<span><span class="co">#&gt; 4  always_test        b   nord      always       0.50       0.70</span></span>
<span><span class="co">#&gt; 5  always_test        b  south      always       0.25       0.30</span></span>
<span><span class="co">#&gt; 6  always_test        b   east      always       0.30       0.50</span></span>
<span><span class="co">#&gt; 7            0        a   nord   sometimes       0.08       0.10</span></span>
<span><span class="co">#&gt; 8            0        a  south   sometimes       0.02       0.05</span></span>
<span><span class="co">#&gt; 9            0        a   east       never       0.10       0.15</span></span>
<span><span class="co">#&gt; 10           0        b   nord      always       0.50       0.70</span></span>
<span><span class="co">#&gt; 11           0        b  south   sometimes       0.25       0.30</span></span>
<span><span class="co">#&gt; 12           0        b   east     unknown       0.30       0.50</span></span></code></pre></div>
<p>Now we create the mcmodule and calculate the totals. Note that, since
most functions for working with mcmodules both take and return
mcmodules, you can use the pipe <code>%&gt;%</code> to simplify your
workflow</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports_wif</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eval_module.html">eval_module</a></span><span class="op">(</span></span>
<span>  exp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>imports <span class="op">=</span> <span class="va">imports_exp</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">imports_data_wif</span>,</span>
<span>  mctable <span class="op">=</span> <span class="va">imports_mctable</span>,</span>
<span>  data_keys <span class="op">=</span> <span class="va">imports_data_keys</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; imports evaluated</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; mcmodule created (expressions: imports)</span></span>
<span></span>
<span><span class="va">imports_wif</span> <span class="op">&lt;-</span> <span class="va">imports_wif</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/trial_totals.html">trial_totals</a></span><span class="op">(</span></span>
<span>    mc_names <span class="op">=</span> <span class="st">"no_detect"</span>,</span>
<span>    trials_n <span class="op">=</span> <span class="st">"animals_n"</span>,</span>
<span>    subsets_n <span class="op">=</span> <span class="st">"farms_n"</span>,</span>
<span>    subsets_p <span class="op">=</span> <span class="st">"h_prev"</span>,</span>
<span>    mctable <span class="op">=</span> <span class="va">imports_mctable</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/agg_totals.html">agg_totals</a></span><span class="op">(</span></span>
<span>    mc_name <span class="op">=</span> <span class="st">"no_detect_set"</span>,</span>
<span>    agg_keys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pathogen"</span>, <span class="st">"scenario_id"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; data_name is not equal for all nodes, using 'no_detect' data_name 'imports_data_wif' for node creation</span></span>
<span><span class="co">#&gt; 3 variates per group for no_detect_set</span></span>
<span></span>
<span><span class="co"># Result</span></span>
<span><span class="va">imports_wif</span><span class="op">$</span><span class="va">node_list</span><span class="op">$</span><span class="va">no_detect_set_agg</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt;              mc_name scenario_id pathogen      mean           sd       Min</span></span>
<span><span class="co">#&gt; 1  no_detect_set_agg always_test        a 0.7870938 2.961028e-02 0.7025825</span></span>
<span><span class="co">#&gt; 4  no_detect_set_agg always_test        b 0.9999829 1.738871e-05 0.9998839</span></span>
<span><span class="co">#&gt; 7  no_detect_set_agg           0        a 0.8271197 2.586876e-02 0.7512733</span></span>
<span><span class="co">#&gt; 10 no_detect_set_agg           0        b 0.9999843 1.684724e-05 0.9998893</span></span>
<span><span class="co">#&gt;         2.5%       25%       50%       75%     97.5%       Max  nsv Na's</span></span>
<span><span class="co">#&gt; 1  0.7262427 0.7673428 0.7895126 0.8073118 0.8390978 0.8532887 1001    0</span></span>
<span><span class="co">#&gt; 4  0.9999316 0.9999779 0.9999893 0.9999947 0.9999985 0.9999993 1001    0</span></span>
<span><span class="co">#&gt; 7  0.7737190 0.8098454 0.8274998 0.8465280 0.8724942 0.8823499 1001    0</span></span>
<span><span class="co">#&gt; 10 0.9999340 0.9999803 0.9999903 0.9999953 0.9999987 0.9999993 1001    0</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="working-with-multiple-mcmodules">Working with multiple mcmodules<a class="anchor" aria-label="anchor" href="#working-with-multiple-mcmodules"></a>
</h2>
<p>As your risk analysis grows in complexity, you may need to split your
model into several independent modules and then combine them.</p>
<div class="section level3">
<h3 id="inputs-from-previous-mcmodules">Inputs from previous mcmodules<a class="anchor" aria-label="anchor" href="#inputs-from-previous-mcmodules"></a>
</h3>
<p>Often, the output from one module serves as input for another. For
example, after estimating the probability that an imported animal is not
detected, you may want to model the probability that this animal
transmits a pathogen via direct contact.</p>
<p>To do this, simply pass the previous mcmodule as the
<code>prev_mcmodule</code> argument when creating the new module. This
makes all nodes from the previous module available for use in
expressions in the new module.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#  Create pathogen data table</span></span>
<span><span class="va">transmission_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  pathogen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>,</span>
<span>  inf_dc_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.3</span><span class="op">)</span>,</span>
<span>  inf_dc_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.08</span>, <span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">transmission_data_keys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>transmission_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pathogen"</span>, <span class="st">"inf_dc_min"</span>, <span class="st">"inf_dc_max"</span><span class="op">)</span>,</span>
<span>  keys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pathogen"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">transmission_mctable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  mcnode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"inf_dc"</span><span class="op">)</span>,</span>
<span>  description <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Probability of infection via direct contact"</span><span class="op">)</span>,</span>
<span>  mc_func <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"runif"</span><span class="op">)</span>,</span>
<span>  from_variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  transformation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  sensi_analysis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dir_contact_exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">dir_contact</span> <span class="op">&lt;-</span> <span class="va">no_detect</span> <span class="op">*</span> <span class="va">inf_dc</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">transmission</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eval_module.html">eval_module</a></span><span class="op">(</span></span>
<span>  exp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>dir_contact <span class="op">=</span> <span class="va">dir_contact_exp</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">transmission_data</span>,</span>
<span>  mctable <span class="op">=</span> <span class="va">transmission_mctable</span>,</span>
<span>  data_keys <span class="op">=</span> <span class="va">transmission_data_keys</span>,</span>
<span>  prev_mcmodule <span class="op">=</span> <span class="va">imports_wif</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Group by: pathogen</span></span>
<span><span class="co">#&gt; no_detect prev dim: [1001, 1, 12], new dim: [1001, 1, 12], 0 null matches</span></span>
<span><span class="co">#&gt; data prev dim: [2, 3], new dim: [12, 4], 0 null matches</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; dir_contact evaluated</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; mcmodule created (expressions: dir_contact)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/mc_network.html">mc_network</a></span><span class="op">(</span><span class="va">transmission</span>, legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-36aa3d2a04d42bbc2145" style="width:100%;height:432.632880098888px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"nodes":{"id":["inf_dc","no_detect","dir_contact"],"color":["#6ABDEB","#A4CF96","#A4CF96"],"color_by":["in_node","out_node","out_node"],"grouping":["dir_contact","imports","dir_contact"],"expression":["runif","false_neg + no_test","no_detect * inf_dc"],"title":["<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>inf_dc<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">dir_contact<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>6.44% (5.04%-7.92%)<br><\/strong>runif<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">inf_dc_min<br> inf_dc_max<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>1.75% (1.48%-2.05%)<br><\/strong>false_neg + no_test<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">false_neg<br> no_test<\/td>\n          <td style=\"width: 50%; text-align: center;\">false_neg<br> no_test<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>dir_contact<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">dir_contact<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.11% (0.08%-0.15%)<br><\/strong>no_detect * inf_dc<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> inf_dc<\/td>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> inf_dc<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>"],"type":["in_node","out_node","out_node"],"label":["inf_dc","no_detect","dir_contact"],"x":[-1,1,0],"y":[-1,-1,1]},"edges":{"from":["no_detect","inf_dc"],"to":["dir_contact","dir_contact"],"id":[3,4]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"arrows":"to","smooth":false},"physics":{"enabled":false},"interaction":{"dragNodes":true,"zoomSpeed":1}},"groups":["dir_contact","imports"],"width":"100%","height":null,"idselection":{"enabled":true,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":true,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false,"variable":"grouping","main":"Select by grouping","values":["dir_contact","imports"]},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":2,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":false,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":false,"nodes":{"label":["in_node","out_node"],"color":["#6ABDEB","#A4CF96"],"shape":["dot","dot"],"title":["Node type","Node type"],"font.size":[15,15]},"nodesToDataframe":true}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="combining-mcmodules">Combining mcmodules<a class="anchor" aria-label="anchor" href="#combining-mcmodules"></a>
</h3>
<p>To merge two or more modules into a single unified model, use the
<code><a href="../reference/combine_modules.html">combine_modules()</a></code> function. This will join their data,
nodes, and expressions, allowing you to perform further calculations or
summaries across the combined structure.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">intro</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine_modules.html">combine_modules</a></span><span class="op">(</span><span class="va">imports_wif</span>, <span class="va">transmission</span><span class="op">)</span></span>
<span><span class="va">intro</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/at_least_one.html">at_least_one</a></span><span class="op">(</span><span class="va">intro</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"no_detect"</span>, <span class="st">"dir_contact"</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"total"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2 variates per group for dir_contact</span></span>
<span><span class="co">#&gt; 2 variates per group for dir_contact</span></span>
<span><span class="co">#&gt; no_detect prev dim: [1001, 1, 12], new dim: [1001, 1, 24], 0 null matches</span></span>
<span><span class="co">#&gt; dir_contact prev dim: [1001, 1, 12], new dim: [1001, 1, 24], 0 null matches</span></span>
<span><span class="va">intro</span><span class="op">$</span><span class="va">node_list</span><span class="op">$</span><span class="va">total</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt;    mc_name scenario_id pathogen origin       mean          sd        Min</span></span>
<span><span class="co">#&gt; 1    total always_test        a   nord 0.01864184 0.001722597 0.01459353</span></span>
<span><span class="co">#&gt; 2    total always_test        a   nord 0.02370509 0.001870742 0.01924184</span></span>
<span><span class="co">#&gt; 3    total always_test        a  south 0.01868934 0.001745219 0.01496515</span></span>
<span><span class="co">#&gt; 4    total always_test        a  south 0.02367750 0.001865563 0.01861923</span></span>
<span><span class="co">#&gt; 5    total always_test        a   east 0.01855234 0.001674436 0.01475818</span></span>
<span><span class="co">#&gt; 6    total always_test        a   east 0.02861171 0.002240960 0.02276387</span></span>
<span><span class="co">#&gt; 7    total always_test        b   nord 0.10376668 0.015961466 0.06188676</span></span>
<span><span class="co">#&gt; 8    total always_test        b   nord 0.10413476 0.012723355 0.07674719</span></span>
<span><span class="co">#&gt; 9    total always_test        b  south 0.07648329 0.009880278 0.05044538</span></span>
<span><span class="co">#&gt; 10   total always_test        b  south 0.13057220 0.009530128 0.10475917</span></span>
<span><span class="co">#&gt; 11   total always_test        b   east 0.10377878 0.015448960 0.06096255</span></span>
<span><span class="co">#&gt; 12   total always_test        b   east 0.24769031 0.022338128 0.19276733</span></span>
<span><span class="co">#&gt; 13   total           0        a   nord 0.09759581 0.008031210 0.08307071</span></span>
<span><span class="co">#&gt; 14   total           0        a   nord 0.10224721 0.008507702 0.08645002</span></span>
<span><span class="co">#&gt; 15   total           0        a  south 0.09714558 0.007822626 0.08330352</span></span>
<span><span class="co">#&gt; 16   total           0        a  south 0.10173070 0.008280033 0.08626187</span></span>
<span><span class="co">#&gt; 17   total           0        a   east 0.17606590 0.014269714 0.15081487</span></span>
<span><span class="co">#&gt; 18   total           0        a   east 0.18449788 0.014907436 0.15696650</span></span>
<span><span class="co">#&gt; 19   total           0        b   nord 0.10462950 0.012762992 0.07436241</span></span>
<span><span class="co">#&gt; 20   total           0        b   nord 0.10489817 0.015723152 0.06315414</span></span>
<span><span class="co">#&gt; 21   total           0        b  south 0.23710063 0.006694263 0.21909044</span></span>
<span><span class="co">#&gt; 22   total           0        b  south 0.28175620 0.008963509 0.25666578</span></span>
<span><span class="co">#&gt; 23   total           0        b   east 0.53795167 0.041940602 0.46301834</span></span>
<span><span class="co">#&gt; 24   total           0        b   east 0.61146281 0.043084223 0.52625426</span></span>
<span><span class="co">#&gt;          2.5%        25%        50%        75%      97.5%        Max  nsv Na's</span></span>
<span><span class="co">#&gt; 1  0.01577198 0.01727634 0.01856005 0.02003115 0.02187540 0.02295662 1001    0</span></span>
<span><span class="co">#&gt; 2  0.02026281 0.02230448 0.02364317 0.02504929 0.02727800 0.02962124 1001    0</span></span>
<span><span class="co">#&gt; 3  0.01567118 0.01727162 0.01863359 0.02008781 0.02186627 0.02301175 1001    0</span></span>
<span><span class="co">#&gt; 4  0.02032720 0.02226212 0.02358051 0.02504635 0.02722227 0.02890008 1001    0</span></span>
<span><span class="co">#&gt; 5  0.01564087 0.01722423 0.01847063 0.01979313 0.02181840 0.02308171 1001    0</span></span>
<span><span class="co">#&gt; 6  0.02458871 0.02699695 0.02846669 0.03016160 0.03300551 0.03478318 1001    0</span></span>
<span><span class="co">#&gt; 7  0.07646553 0.09191313 0.10264578 0.11556943 0.13568311 0.14849396 1001    0</span></span>
<span><span class="co">#&gt; 8  0.08119772 0.09471157 0.10354945 0.11328839 0.12945283 0.14512739 1001    0</span></span>
<span><span class="co">#&gt; 9  0.05808618 0.06869976 0.07662859 0.08364628 0.09542524 0.10126246 1001    0</span></span>
<span><span class="co">#&gt; 10 0.11278802 0.12378312 0.13044441 0.13708526 0.14921591 0.15523800 1001    0</span></span>
<span><span class="co">#&gt; 11 0.07529536 0.09259944 0.10335903 0.11493394 0.13372123 0.14976307 1001    0</span></span>
<span><span class="co">#&gt; 12 0.20740705 0.23168462 0.24662517 0.26311527 0.29245767 0.31513411 1001    0</span></span>
<span><span class="co">#&gt; 13 0.08421563 0.09075189 0.09784627 0.10452968 0.11053958 0.11136198 1001    0</span></span>
<span><span class="co">#&gt; 14 0.08803834 0.09503238 0.10261575 0.10949245 0.11617387 0.11796002 1001    0</span></span>
<span><span class="co">#&gt; 15 0.08447858 0.09050448 0.09686338 0.10389016 0.11012443 0.11177025 1001    0</span></span>
<span><span class="co">#&gt; 16 0.08814450 0.09468725 0.10157277 0.10889514 0.11586967 0.11778942 1001    0</span></span>
<span><span class="co">#&gt; 17 0.15214975 0.16396387 0.17584465 0.18846654 0.19944215 0.20079121 1001    0</span></span>
<span><span class="co">#&gt; 18 0.15981536 0.17208015 0.18491405 0.19736348 0.20892399 0.21150583 1001    0</span></span>
<span><span class="co">#&gt; 19 0.08068174 0.09518206 0.10466374 0.11312204 0.13024624 0.14145700 1001    0</span></span>
<span><span class="co">#&gt; 20 0.07607474 0.09337515 0.10470606 0.11644788 0.13594919 0.14748013 1001    0</span></span>
<span><span class="co">#&gt; 21 0.22421345 0.23205190 0.23716986 0.24203619 0.24945933 0.25574089 1001    0</span></span>
<span><span class="co">#&gt; 22 0.26473783 0.27517730 0.28155851 0.28799086 0.29930387 0.30641192 1001    0</span></span>
<span><span class="co">#&gt; 23 0.46918916 0.50094123 0.53826630 0.57501602 0.60554120 0.61272730 1001    0</span></span>
<span><span class="co">#&gt; 24 0.53823191 0.57451359 0.61227060 0.64868864 0.68275115 0.69391415 1001    0</span></span>
<span></span>
<span><span class="fu"><a href="../reference/mc_network.html">mc_network</a></span><span class="op">(</span><span class="va">intro</span>, legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-febe03efa1a2d8d52a86" style="width:100%;height:432.632880098888px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-febe03efa1a2d8d52a86">{"x":{"nodes":{"id":["w_prev","test_origin","test_sensi","infected","false_neg","no_test","no_detect","animals_n","farms_n","h_prev","no_detect_trial","no_detect_subset","no_detect_subset_n","no_detect_set","no_detect_set_n","no_detect_set_agg","inf_dc","dir_contact","total"],"color":["#6ABDEB","#6ABDEB","#6ABDEB","#A4CF96","#A4CF96","#A4CF96","#A4CF96","#FAE4CB","#FAE4CB","#FAE4CB","#F39200","#F39200","#F39200","#F39200","#F39200","#C17816","#6ABDEB","#A4CF96","#F39200"],"color_by":["in_node","in_node","in_node","out_node","out_node","out_node","out_node","trials_n","subsets_n","subsets_p","total","total","total","total","total","agg_total","in_node","out_node","total"],"grouping":["imports","imports","imports","imports","imports","imports","imports",".",".",".",".",".",".",".",".",".","dir_contact","dir_contact","intro"],"expression":["runif","mcdata","rpert","w_prev","infected * test_origin * (1 - test_sensi)","infected * (1 - test_origin)","false_neg + no_test",null,null,null,null,null,null,null,null,null,"runif","no_detect * inf_dc",null],"title":["<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>w_prev<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>17.53% (15.12%-19.87%)<br><\/strong>runif<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">w_prev_min<br> w_prev_max<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>test_origin<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>1<br><\/strong>mcdata<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">test_origin<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>test_sensi<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>89.98% (89.3%-90.65%)<br><\/strong>rpert<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">test_sensi_min<br> test_sensi_mode<br> test_sensi_max<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>infected<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>17.53% (15.12%-19.87%)<br><\/strong>w_prev<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">w_prev<\/td>\n          <td style=\"width: 50%; text-align: center;\">w_prev<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>false_neg<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>1.75% (1.48%-2.05%)<br><\/strong>infected * test_origin * (1 - test_sensi)<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">infected<br> test_origin<br> test_sensi<\/td>\n          <td style=\"width: 50%; text-align: center;\">infected<br> test_origin<br> test_sensi<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_test<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0% (0%-0%)<br><\/strong>infected * (1 - test_origin)<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">infected<br> test_origin<\/td>\n          <td style=\"width: 50%; text-align: center;\">infected<br> test_origin<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">imports<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>1.75% (1.48%-2.05%)<br><\/strong>false_neg + no_test<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">false_neg<br> no_test<\/td>\n          <td style=\"width: 50%; text-align: center;\">false_neg<br> no_test<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>animals_n<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">.<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>100.26 (88.72-111.62)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">animals_n_mean<br> animals_n_sd<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>farms_n<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">.<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>5<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">farms_n<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>h_prev<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">.<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>8.99% (8.05%-9.95%)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">h_prev_min<br> h_prev_max<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect_trial<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">.<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.16% (0.13%-0.19%)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> h_prev<\/td>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> h_prev<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect_subset<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">.<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>7.45% (6.35%-8.49%)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> h_prev<\/td>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> h_prev<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect_subset_n<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">.<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.16 (0.12-0.2)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> h_prev<\/td>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> h_prev<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect_set<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">.<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>32.09% (27.95%-35.82%)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> farms_n<br> h_prev<\/td>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> farms_n<br> h_prev<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect_set_n<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">.<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.79 (0.6-1)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> farms_n<br> h_prev<\/td>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> animals_n<br> farms_n<br> h_prev<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>no_detect_set_agg<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">.<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>78.95% (72.62%-83.91%)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">no_detect_set<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>inf_dc<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">dir_contact<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>6.44% (5.04%-7.92%)<br><\/strong>runif<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\"><\/td>\n          <td style=\"width: 50%; text-align: center;\">inf_dc_min<br> inf_dc_max<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>dir_contact<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">dir_contact<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>0.11% (0.08%-0.15%)<br><\/strong>no_detect * inf_dc<\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> inf_dc<\/td>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> inf_dc<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>","<p style=\"text-align: center;\"><strong><span style=\"font-size: 18px;\"><u>total<\/u><br><\/span><\/strong><span style=\"font-size: 12px;\">intro<\/span><\/p>\n    <p style=\"text-align: center;\"><strong>1.86% (1.58%-2.19%)<br><\/strong><\/p>\n    <table style=\"width: 100%; border-collapse: collapse; margin: 0px auto;\">\n      <tbody>\n        <tr>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>param<\/strong><\/td>\n          <td style=\"width: 50%; text-align: center; background-color: rgb(239, 239, 239);\"><strong>inputs<\/strong><\/td>\n        <\/tr>\n        <tr>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> dir_contact<\/td>\n          <td style=\"width: 50%; text-align: center;\">no_detect<br> dir_contact<br><\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>"],"type":["in_node","in_node","in_node","out_node","out_node","out_node","out_node","trials_n","subsets_n","subsets_p","total","total","total","total","total","agg_total","in_node","out_node","total"],"label":["w_prev","test_origin","test_sensi","infected","false_neg","no_test","no_detect","animals_n","farms_n","h_prev","no_detect_trial","no_detect_subset","no_detect_subset_n","no_detect_set","no_detect_set_n","no_detect_set_agg","inf_dc","dir_contact","total"],"x":[-0.5483870967741935,-0.3548387096774194,-0.2258064516129032,-0.09677419354838712,0.09677419354838701,-0.09677419354838712,0.09677419354838701,-0.032258064516129,0.2903225806451613,0.8064516129032258,0.6774193548387097,0.4838709677419355,0.1612903225806452,-0.4838709677419355,1,-0.4838709677419355,-1,-0.935483870967742,-1],"y":[-1,-1,-1,-0.6,-0.2,-0.2,0.2,-1,-1,-1,0.6000000000000001,0.6000000000000001,0.6000000000000001,0.6000000000000001,0.6000000000000001,1,-1,0.6000000000000001,1]},"edges":{"from":["w_prev","infected","test_origin","test_sensi","infected","test_origin","false_neg","no_test","no_detect","h_prev","no_detect","animals_n","h_prev","no_detect","animals_n","h_prev","no_detect","animals_n","farms_n","h_prev","no_detect","animals_n","farms_n","h_prev","no_detect_set","no_detect","inf_dc","no_detect","dir_contact"],"to":["infected","false_neg","false_neg","false_neg","no_test","no_test","no_detect","no_detect","no_detect_trial","no_detect_trial","no_detect_subset","no_detect_subset","no_detect_subset","no_detect_subset_n","no_detect_subset_n","no_detect_subset_n","no_detect_set","no_detect_set","no_detect_set","no_detect_set","no_detect_set_n","no_detect_set_n","no_detect_set_n","no_detect_set_n","no_detect_set_agg","dir_contact","dir_contact","total","total"],"id":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"arrows":"to","smooth":false},"physics":{"enabled":false},"interaction":{"dragNodes":true,"zoomSpeed":1}},"groups":["imports",".","dir_contact","intro"],"width":"100%","height":null,"idselection":{"enabled":true,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":true,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false,"variable":"grouping","main":"Select by grouping","values":[".","dir_contact","imports","intro"]},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":2,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":false,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":false,"nodes":{"label":["in_node","out_node","trials_info","total","agg_total"],"color":["#6ABDEB","#A4CF96","#FAE4CB","#F39200","#C17816"],"shape":["dot","dot","dot","dot","dot"],"title":["Node type","Node type","Node type","Node type","Node type"],"font.size":[15,15,15,15,15]},"nodesToDataframe":true}},"evals":[],"jsHooks":[]}</script><p>The combined module now contains all nodes and metadata from its
components, enabling you to analyze interactions and aggregate results
across the entire risk pathway.</p>
</div>
</div>
<div class="section level2">
<h2 id="tricks-and-tweaks">Tricks and tweaks<a class="anchor" aria-label="anchor" href="#tricks-and-tweaks"></a>
</h2>
<div class="section level3">
<h3 id="handling-missing-and-infinite-values-in-mcnodes">Handling missing and infinite values in mcnodes<a class="anchor" aria-label="anchor" href="#handling-missing-and-infinite-values-in-mcnodes"></a>
</h3>
<p>When building stochastic nodes, you may encounter missing
(<code>NA</code>) or infinite (<code>Inf</code>, <code>-Inf</code>)
values, especially after mathematical operations or data
transformations. These can cause issues in downstream calculations. Use
<code><a href="../reference/mcnode_na_rm.html">mcnode_na_rm()</a></code> to clean your mcnode by replacing
problematic values with another value (usually zero):</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_mcnode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcstoc.html" class="external-link">mcstoc</a></span><span class="op">(</span><span class="va">runif</span>,</span>
<span>  min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">0.2</span>, <span class="op">-</span><span class="cn">Inf</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"0"</span>, nvariates <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mc2d/man/mcnode.html" class="external-link">mcdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">0.3</span>, <span class="cn">Inf</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"0"</span>, nvariates <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  nvariates <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in (function (n, min = 0, max = 1) : NAs produced</span></span>
<span><span class="co">#&gt; Warning in (function (n, min = 0, max = 1) : NAs produced</span></span>
<span></span>
<span><span class="co"># Replace NA and Inf with 0</span></span>
<span><span class="va">clean_mcnode</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcnode_na_rm.html">mcnode_na_rm</a></span><span class="op">(</span><span class="va">sample_mcnode</span><span class="op">)</span></span></code></pre></div>
<p>This is especially useful in expressions where a denominator might be
zero, resulting in <code>Inf</code> or <code>NaN</code>, but you want
the output to be zero instead.</p>
</div>
<div class="section level3">
<h3 id="customizing-total-node-names">Customizing total node names<a class="anchor" aria-label="anchor" href="#customizing-total-node-names"></a>
</h3>
<p>Functions like <code><a href="../reference/at_least_one.html">at_least_one()</a></code>,
<code><a href="../reference/agg_totals.html">agg_totals()</a></code>, and <code><a href="../reference/trial_totals.html">trial_totals()</a></code> automatically
generate new mcnodes with informative suffixes. You can customize these
names for clarity or documentation purposes:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Custom name for at_least_one()</span></span>
<span><span class="va">intro</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/at_least_one.html">at_least_one</a></span><span class="op">(</span><span class="va">intro</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"no_detect"</span>, <span class="st">"dir_contact"</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"custom_total"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2 variates per group for dir_contact</span></span>
<span><span class="co">#&gt; 2 variates per group for dir_contact</span></span>
<span><span class="co">#&gt; no_detect prev dim: [1001, 1, 12], new dim: [1001, 1, 24], 0 null matches</span></span>
<span><span class="co">#&gt; dir_contact prev dim: [1001, 1, 12], new dim: [1001, 1, 24], 0 null matches</span></span>
<span></span>
<span><span class="co"># Custom name for agg_totals()</span></span>
<span><span class="va">intro</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/agg_totals.html">agg_totals</a></span><span class="op">(</span><span class="va">intro</span>, <span class="st">"no_detect_set"</span>, name <span class="op">=</span> <span class="st">"custom_agg"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Keys to aggregate by not provided, using 'scenario_id' by default</span></span>
<span><span class="co">#&gt; 6 variates per group for no_detect_set</span></span>
<span></span>
<span><span class="co"># Custom suffix for agg_totals()</span></span>
<span><span class="va">intro</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/agg_totals.html">agg_totals</a></span><span class="op">(</span><span class="va">intro</span>, <span class="st">"no_detect_set"</span>,</span>
<span>  agg_keys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"scenario_id"</span>, <span class="st">"pathogen"</span><span class="op">)</span>,</span>
<span>  agg_suffix <span class="op">=</span> <span class="st">"aggregated"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; 3 variates per group for no_detect_set</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="prefixing-mcmodules-to-avoid-name-duplication">Prefixing mcmodules to avoid name duplication<a class="anchor" aria-label="anchor" href="#prefixing-mcmodules-to-avoid-name-duplication"></a>
</h3>
<p>If your project includes multiple modules with similar or repeated
expressions, duplicated node names can cause problems when combining
modules. Use <code><a href="../reference/add_prefix.html">add_prefix()</a></code> to add a unique prefix to each
module, making node names distinct:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports_wif</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_prefix.html">add_prefix</a></span><span class="op">(</span><span class="va">imports_wif</span><span class="op">)</span></span></code></pre></div>
<p>By default, the prefix is the mcmodule name, but you can specify a
custom prefix if needed.</p>
</div>
<div class="section level3">
<h3 id="functions-that-work-outside-mcmodules">Functions that work outside mcmodules<a class="anchor" aria-label="anchor" href="#functions-that-work-outside-mcmodules"></a>
</h3>
<p>Some functions in <code>mcmodule</code> can be used independently of
the full module workflow:</p>
<ul>
<li>
<strong><code><a href="../reference/create_mcnodes.html">create_mcnodes()</a></code></strong>: Quickly generate
mcnodes from a data frame and mctable, useful for prototyping or
testing</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_mcnodes.html">create_mcnodes</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">prevalence_region</span>, mctable <span class="op">=</span> <span class="va">imports_mctable</span><span class="op">)</span></span>
<span><span class="co"># Nodes are created in the environment</span></span>
<span><span class="va">h_prev</span></span>
<span><span class="co">#&gt;   node    mode  nsv nsu nva variate  min   mean median   max Nas type outm</span></span>
<span><span class="co">#&gt; 1    x numeric 1001   1   6       1 0.08 0.0898 0.0897 0.100   0    V each</span></span>
<span><span class="co">#&gt; 2    x numeric 1001   1   6       2 0.02 0.0348 0.0351 0.050   0    V each</span></span>
<span><span class="co">#&gt; 3    x numeric 1001   1   6       3 0.10 0.1247 0.1248 0.150   0    V each</span></span>
<span><span class="co">#&gt; 4    x numeric 1001   1   6       4 0.50 0.6004 0.6019 0.699   0    V each</span></span>
<span><span class="co">#&gt; 5    x numeric 1001   1   6       5 0.25 0.2748 0.2749 0.300   0    V each</span></span>
<span><span class="co">#&gt; 6    x numeric 1001   1   6       6 0.30 0.3997 0.4003 0.500   0    V each</span></span></code></pre></div>
<ul>
<li>
<strong><code><a href="../reference/mc_summary.html">mc_summary()</a></code></strong>: Summarize a mcnode
directly from data, without needing a full mcmodule</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mc_summary.html">mc_summary</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">prevalence_region</span>, mcnode <span class="op">=</span> <span class="va">h_prev</span>, keys_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pathogen"</span>, <span class="st">"origin"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   mc_name pathogen origin       mean          sd        Min       2.5%</span></span>
<span><span class="co">#&gt; 1  h_prev        a   nord 0.08984965 0.005654399 0.08002695 0.08066379</span></span>
<span><span class="co">#&gt; 2  h_prev        a  south 0.03479932 0.008402450 0.02000010 0.02096417</span></span>
<span><span class="co">#&gt; 3  h_prev        a   east 0.12474572 0.014348430 0.10022718 0.10141002</span></span>
<span><span class="co">#&gt; 4  h_prev        b   nord 0.60035015 0.058114326 0.50032837 0.50534204</span></span>
<span><span class="co">#&gt; 5  h_prev        b  south 0.27476835 0.014409080 0.25000373 0.25120829</span></span>
<span><span class="co">#&gt; 6  h_prev        b   east 0.39974356 0.057582019 0.30004862 0.30545918</span></span>
<span><span class="co">#&gt;          25%        50%        75%      97.5%        Max  nsv Na's</span></span>
<span><span class="co">#&gt; 1 0.08490048 0.08974444 0.09477030 0.09941642 0.09997288 1001    0</span></span>
<span><span class="co">#&gt; 2 0.02746444 0.03506422 0.04156208 0.04905658 0.04995957 1001    0</span></span>
<span><span class="co">#&gt; 3 0.11230453 0.12484675 0.13740968 0.14855966 0.14995920 1001    0</span></span>
<span><span class="co">#&gt; 4 0.54909600 0.60194187 0.64940650 0.69660311 0.69940735 1001    0</span></span>
<span><span class="co">#&gt; 5 0.26249574 0.27489560 0.28750651 0.29819924 0.29995479 1001    0</span></span>
<span><span class="co">#&gt; 6 0.35014904 0.40028928 0.45042144 0.49469691 0.49999998 1001    0</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="next-steps">Next steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p>We are planning to add functions to perform uncertainty, sensitivity,
and convergence analysis in multivariate, modular models. To be notified
when it is released, you can watch our repository: <a href="https://github.com/NataliaCiria/mcmodule" class="external-link uri">https://github.com/NataliaCiria/mcmodule</a>.</p>
<p>We encourage you to explore the package further, adapt it to your own
use cases, and contribute feedback or improvements. To report bugs,
please visit: <a href="https://github.com/NataliaCiria/mcmodule/issues" class="external-link uri">https://github.com/NataliaCiria/mcmodule/issues</a> or
contact <a href="mailto:mail@nataliaciria.com">mail@nataliaciria.com</a>.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-visnetwork" class="csl-entry">
Almende B. V., and Benoit Thieurmel. 2025. <span>“Visnetwork: Network
Visualization Using ’Vis. <span>Js</span>’ Library.”</span> <a href="https://CRAN.R-project.org/package=visNetwork" class="external-link">https://CRAN.R-project.org/package=visNetwork</a>.
</div>
<div id="ref-igraph" class="csl-entry">
Csardi, Gabor, and Tamas Nepusz. 2006. <span>“The Igraph Software
Package for Complex Network Research”</span> Complex Systems: 1695. <a href="https://igraph.org" class="external-link">https://igraph.org</a>.
</div>
<div id="ref-Murray2004" class="csl-entry">
Murray, Noel. 2004. <em>Handbook on <span>Import</span>
<span>Risk</span> <span>Analysis</span> for <span>Animals</span> and
<span>Animal</span> <span>Products</span> <span>Volume</span> 2
<span>Quantitative</span> Risk Assessment</em>. Vol. 2. <a href="https://rr-africa.woah.org/app/uploads/2018/03/handbook_on_import_risk_analysis_-_oie_-_vol_ii.pdf" class="external-link">https://rr-africa.woah.org/app/uploads/2018/03/handbook_on_import_risk_analysis_-_oie_-_vol_ii.pdf</a>.
</div>
<div id="ref-mc2d" class="csl-entry">
Pouillot, R., and M.-L. Delignette-Muller. 2010. <span>“Evaluating
Variability and Uncertainty in Microbial Quantitative Risk Assessment
Using Two r Packages”</span> 142: 330–40.
</div>
<div id="ref-base" class="csl-entry">
R Core Team. 2024. <span>“R: A Language and Environment for Statistical
Computing.”</span> <a href="https://www.R-project.org/" class="external-link">https://www.R-project.org/</a>.
</div>
<div id="ref-Vose2008" class="csl-entry">
Vose, David. 2008. <em>Risk Analysis, a Quantitative Guide</em>.
Chichester, England: John Wiley &amp; Sons.
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Natalia Ciria.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
